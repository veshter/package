-- --------------------------------------------------------
-- Host:                         vdbgsbwc.db.11401321.hostedresource.com
-- Server version:               5.0.96-log - MySQL Community Server (GPL)
-- Server OS:                    unknown-linux-gnu
-- HeidiSQL Version:             8.0.0.4396
-- --------------------------------------------------------

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET NAMES utf8 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;

-- Dumping structure for table vdbgsbwc.basiccontent
CREATE TABLE IF NOT EXISTS `basiccontent` (
  `guid` varchar(32) NOT NULL,
  `parent` varchar(32) default NULL,
  `wrapper` varchar(32) default NULL,
  `realm` varchar(255) NOT NULL default 'general',
  `category` varchar(255) default NULL,
  `folder` varchar(255) NOT NULL,
  `filename` varchar(50) NOT NULL,
  `workgroup` varchar(255) default NULL,
  `title` varchar(255) default NULL,
  `description` varchar(500) default NULL,
  `keywords` varchar(500) default NULL,
  `image` longblob COMMENT 'Any ENGINE of binary data',
  `meta_image` text COMMENT 'META data for the binary column',
  `type` varchar(50) NOT NULL,
  `stereotype` varchar(255) default NULL,
  `part` text,
  `part2` text,
  `part3` text,
  `part4` text,
  `part5` text,
  `part6` text,
  `part7` text,
  `part8` text,
  `part9` text,
  `part10` text,
  `priority` int(11) NOT NULL default '0',
  `last_update` int(11) NOT NULL default '0',
  PRIMARY KEY  (`guid`),
  UNIQUE KEY `path` (`folder`,`filename`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1;

-- Dumping data for table vdbgsbwc.basiccontent: 68 rows
/*!40000 ALTER TABLE `basiccontent` DISABLE KEYS */;
INSERT INTO `basiccontent` (`guid`, `parent`, `wrapper`, `realm`, `category`, `folder`, `filename`, `workgroup`, `title`, `description`, `keywords`, `image`, `meta_image`, `type`, `stereotype`, `part`, `part2`, `part3`, `part4`, `part5`, `part6`, `part7`, `part8`, `part9`, `part10`, `priority`, `last_update`) VALUES
	('93EC3193F6C214EC5AAC70D5AC67EDF9', '', NULL, 'administrator', NULL, '', 'manager_edit.vesh', 'sysadmin', 'Manager <sup>2</sup>', NULL, NULL, _binary '', NULL, 'manager', NULL, '<manager orderby="title" location="basiccontent" key="guid" flag_copy="flag_copy">\r\n	<view template="block.view.admin.generic" where="type=\'manager\'">\r\n		<column type="guid" title="ID" name="guid" />\r\n		<column type="text" title="Title" name="title" />\r\n              		<column type="link" title="Web Path" name="path" value="CONCAT(\'/content/\', realm, CASE WHEN folder!=\'\' AND folder IS NOT NULL THEN CONCAT(\'/\', folder) ELSE \'\' END, \'/\', filename) "/>\r\n	</view>\r\n	<form name="edit_this" template="block.form.generic" prefix_template_element="block.form.element">\r\n		<tab name="Content">\r\n			<element type="hidden" name="do" value="edited" readonly="yes" />\r\n			<element type="hidden" name="guid" />\r\n			<element type="hidden" name="type" value="manager"/>\r\n			<element type="hidden" name="realm" value="administrator"/>\r\n\r\n			<element type="text" title="Folder" name="folder" value=""  description="" validation="/^[A-Za-z_\\/]*$/"/>\r\n			<element type="text" title="File name" name="filename" value=""  description="" minlength="5" validation="/^[A-Za-z_]+\\.[a-z]+$/"/>\r\n\r\n			<element type="text" title="Title" name="title" value="" description="" />\r\n\r\n\r\n			<!--element type="text" title="Wrapper" name="wrapper" value="" description="" />\r\n			<element type="text" title="Realm" name="realm" value="" description="" />\r\n			<element type="text" title="Category" name="category" value="" description="" />\r\n			<element type="text" title="Path" name="path" value="" description="" />\r\n			<element type="text" title="Workgroup" name="workgroup" value="" description="" />\r\n			<element type="text" title="Title" name="title" value="" description="" />\r\n			<element type="text" title="Description" name="description" value="" description="" />\r\n			<element type="text" title="Keywords" name="keywords" value="" description="" />\r\n			<element type="text" title="Image" name="image" value="" description="" />\r\n			<element type="text" title="Meta Image" name="meta_image" value="" description="" />\r\n			<element type="text" title="Type" name="type" value="" description="" />\r\n			<element type="text" title="Stereotype" name="stereotype" value="" description="" /-->\r\n		</tab>\r\n                <tab name="Configuration" workgroup="sysadmin">\r\n                       \r\n                        <element type="textarea" title="XML" name="part" value="" description="" wrap="off" style="width:100%" rows="40"/>\r\n                </tab>\r\n		<tab name="Security">\r\n			<element type="combobox" title="Workgroup" name="workgroup" value="admin" options="codename,name" location="workgroup" where="1" orderby="name" limit="-1" description=""/>\r\n		</tab>\r\n\r\n    <tab name="SysAdmin" workgroup="sysadmin">\r\n                        <element type="text" title="Realm" name="realm" value="general" description="Usually, this value is general, member or administrator but can be anything sensible"/>                       \r\n                        <element type="textarea" title="Premerge" name="part9" value="" description="" wrap="off" style="width:100%" rows="40" template="block.form.element.code"/>\r\n                        <element type="textarea" title="Postmerge" name="part10" value="" description="" wrap="off" style="width:100%" rows="40" template="block.form.element.code"/>\r\n                </tab>\r\n\r\n	</form>\r\n	<form name="delete_this" config="config.manager.form.generic.delete" />\r\n</manager>', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('59B6AE21A61BD2A487EE1EE1A5634011', '', '59B6AE21A61BD2A487EE1EE1A5634063', 'administrator', NULL, '', 'studiohelp.vesh', 'admin', 'Brief Studio Help', NULL, NULL, NULL, NULL, 'page', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '$pageEx = array();\r\n\r\n$about = \'\';\r\n\r\n$filename = str_replace(\'.\', \'_\', CEnvironment::GetSubmittedVariable(\'filename\')) . \'.help\';\r\n$folder = CEnvironment::GetSubmittedVariable(\'folder\');\r\n$realm = CEnvironment::GetSubmittedVariable(\'realm\');\r\n\r\n$c = 0;\r\nwhile (($datagrid = CEnvironment::GetMainApplication()->GetDataGrid($c)) != null)\r\n{\r\n\r\n	$where = CString::Format("folder=%s AND filename=%s AND realm=%s AND type=\'help\'",\r\n	CString::Quote($folder), CString::Quote($filename), CString::Quote($realm));\r\n\r\n	if($datagrid->Select(\'basiccontent\', array(\'part\', \'meta_keywords\'), $where, 1))\r\n	{\r\n\r\n\r\n		$row = $datagrid->GetRow(0, false);\r\n			\r\n		$about = $row[\'part\'];\r\n		$keywords = $row[\'meta_keywords\'];\r\n		\r\n		$about .= \'<p>For more information on this topic, visit our <A HREF="http://www.veshter.com/support?s=\' . $keywords . \' " TARGET="_new">Support Center</A>.\';	\r\n		break;\r\n	}\r\n	$c++;\r\n	\r\n\r\n}\r\n\r\n\r\n\r\nif (CString::IsNullOrEmpty($about))\r\n{\r\n	$about = <<< HTML\r\n\r\n	<p>While we do our best to provide a description for each page in the studio, we do sometimes miss one. \r\nFeel free to notify our support staff of this error message. \r\n\r\n<p>If you need immediate help you should make a ticket in our Ticket Center, \r\nor you can use our online knowledgebase 24/7 in our \r\n<A HREF="http://www.veshter.com/support" TARGET="_new">Support Center</A>.\r\n\r\nHTML;\r\n\r\n}\r\n\r\n$pageEx[\'raw\'] = $about;\r\n\r\nreturn $pageEx;', NULL, 0, 0),
	('E7776C3766AD2905393DE48E60CE0ABF', '', '59B6AE21A61BD2A487EE1EE1A5634062', 'administrator', NULL, '', 'webpart_currentbalance.vesh', 'admin', 'Current Balance', NULL, NULL, _binary '', NULL, 'page', NULL, NULL, '', '', NULL, NULL, NULL, NULL, NULL, '$pageEx = array();\r\n\r\n$session = CEnvironment::GetMainApplication()->GetSession();\r\n\r\n$cache = $session->GetRegisteredVariable(\'currentbalance\', null, false);\r\n\r\nif (CString::IsNullOrEmpty($cache))\r\n{\r\n	$cache = \'No balance found.\';\r\n\r\n	$config = CEnvironment::GetMainApplication()->GetProperties();\r\n\r\n//Look up a balance if providing service\r\n$balance = 0;\r\n		$html = <<< HTML\r\n[balance;frm=\'$ 0,000.00\'] \r\n\r\n<a href="/content/administrator/addfunds.vesh?client=[config.site.client.id]&amount=[balance]" target="paypal">Pay/Prepay</a>\r\n\r\nHTML;\r\n\r\n	$doc = new CDocument($html, \'html\', false);\r\n	$doc->MergeField(\'balance\', $balance);\r\n\r\n	$cache = $doc->ToString();\r\n\r\n	$session->RegisterVariable(\'currentbalance\', $cache, false);\r\n\r\n}\r\nelse\r\n{\r\n	$cache .= \'<!-- from cache -->\';\r\n}\r\n\r\n\r\n$pageEx[\'raw\'] = $cache;\r\n\r\nreturn $pageEx;', NULL, 0, 0),
	('59B6AE21A61BD2A487EE1EE1A5634062', '', NULL, 'administrator', NULL, '', '59B6AE21A61BD2A487EE1EE1A5634062', NULL, 'HTML Theme', NULL, NULL, _binary '', NULL, 'theme', NULL, '[premerge.raw;htmlconv=no;noerr]\r\n[page.part;htmlconv=no;noerr]\r\n[postmerge.raw;htmlconv=no;noerr]', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 0),
	('91E9ADD59AD95065F1DB21E322F69EBC', '', NULL, 'administrator', NULL, '', 'file_edit.vesh', 'file', 'File Manager', NULL, NULL, _binary '', NULL, 'manager', NULL, '<manager location="basiccontent" key="guid" flag_copy="flag_copy" >\r\n        <view orderby="folder,filename,title" template="block.view.admin.generic" where="type=\'binary\'">\r\n                <column type="guid" title="ID" name="guid"/>\r\n	<column type="thumbnail" title="Thumbnail" name="thumbnail" value="CONCAT(\'/content/\', realm, CASE WHEN folder!=\'\' AND folder IS NOT NULL THEN CONCAT(\'/\', folder) ELSE \'\' END, \'/\', filename)" width="60" height="60"/>\r\n                <column type="text" title="Title" name="title" />                \r\n                <column type="link" title="Web Path" name="path" value="CONCAT(\'/content/\', realm, CASE WHEN folder!=\'\' AND folder IS NOT NULL THEN CONCAT(\'/\', folder) ELSE \'\' END, \'/\', filename) "/>\r\n                \r\n        </view>\r\n        <form name="edit_this" template="block.form.generic" prefix_template_element="block.form.element">\r\n                <tab name="Content">\r\n                        <element type="hidden" name="do" value="edited" readonly="yes"/>\r\n                        <element type="hidden" name="guid"/>\r\n                        <element type="hidden" name="type" value="binary"/>\r\n\r\n\r\n	        <element type="text" title="Folder" name="folder" value=""  description="" validation="/^[0-9A-Za-z_\\/]*$/"/>\r\n	        <element type="text" title="File name" name="filename" value=""  description="For example document.pdf. Be sure to include the file extension" minlength="5" validation="/^[0-9A-Za-z_]+\\.[A-Za-z]+$/"/>\r\n\r\n                        <element type="text" title="Title" name="title" value="" description=""/>\r\n                        <element type="browse" title="File" name="image" value="" description="File you would like to upload"/>\r\n                </tab>\r\n                <tab name="META">\r\n                        <element type="textarea" title="Description" name="description" value="" description=""/>\r\n                        <element type="textarea" title="Keywords" name="keywords" value="" description=""/>\r\n                </tab>\r\n                <tab name="Security">\r\n                        <element type="combobox" title="Workgroup" name="workgroup" value="" options="codename,name" location="workgroup" where="1" orderby="name" limit="-1" description="" template="block.form.element.combobox.workgroup"/>\r\n                </tab>\r\n        </form>\r\n        <form name="delete_this" config="config.manager.form.generic.delete"/>\r\n</manager>\r\n', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('5FCDCB9845A204F5EFC9757BAE37ED5B', '', '59B6AE21A61BD2A487EE1EE1A5634062', 'administrator', NULL, '', 'webpart_studionews.vesh', 'admin', 'Studio News', NULL, NULL, _binary '', NULL, 'page', NULL, 'VESHTER WebStudio is full of new and improved features. We hope you enjoy the functionality. The software running this site is open source and information about can be found on <a href="http://www.github.com/veshter" target="_blank">GitHub</a>\r\n', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('557C8509077894907AC597F99C5CDF59', '', '59B6AE21A61BD2A487EE1EE1A5634062', 'administrator', NULL, '', 'webpart_randomtip.vesh', 'admin', 'Random Tip', NULL, NULL, _binary '', NULL, 'page', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '$pageEx = array();\r\n\r\n$tips = array();\r\n$tips[] = "If you have ever used a word processor you can manage most of this web site\'s content";\r\n$tips[] = "Studio pages and reports are automatically formatted to be printer friendly";\r\n$tips[] = "The file bulk uploader is the faster way to put files online";\r\n$tips[] = "When files and pages are created, they are automatically set to be public. You may change this setting and restrict access";\r\n\r\n$pageEx[\'raw\'] = $tips[rand(0, count($tips)-1)];\r\n\r\nreturn $pageEx;', NULL, 0, 0),
	('F941749040E106138997C9977BF83897', '', '59B6AE21A61BD2A487EE1EE1A5634062', 'administrator', NULL, '', 'webpart_sitedetails.vesh', 'admin', 'Web site details', NULL, NULL, NULL, NULL, 'page', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '\r\n$pageEx = array();\r\n\r\n$session = CEnvironment::GetMainApplication()->GetSession();\r\n\r\n$cache = $session->GetRegisteredVariable(\'sitedetails\', null, false);\r\n\r\nif (CString::IsNullOrEmpty($cache))\r\n{\r\n	$cache = \'No contract information found.\';\r\n\r\n	$config = CEnvironment::GetMainApplication()->GetProperties();\r\n\r\n	$internalToken = CEnvironment::GetMainApplication()->GetSession()->GetRegisteredVariable(\'internalToken\', \'\', true);\r\n\r\n	if (!CString::IsNullOrEmpty($internalToken))\r\n	{\r\n		$wsClient = new CSoapClient(\'https://secure.veshter.com/webservices/sitedetails.wsdl\');\r\n		$request = array(\'resource\' => $config[\'site\'][\'resource\'][\'id\'], \'token\' => $internalToken);\r\n		$response = $wsClient->GetCurrentContract($request);  //call this to get response from server\r\n\r\n		if ($response->services != null)\r\n		{\r\n\r\n			$services = $response->services;\r\n			if (!is_array($services))\r\n			{\r\n				$services = array($services);\r\n			}\r\n			for ($loop = 0; $loop < count($services); $loop++)\r\n			{\r\n				$services[$loop] = array(\'name\' => CString::Format(\'%s<div class="tip">%s</div>\', $services[$loop]->name, $services[$loop]->about),\r\n			\'quantity\' => $services[$loop]->quantity);\r\n			}\r\n\r\n\r\n			$xml = <<<XML\r\n<view template="block.view.admin.report.simple">\r\n	<column type="text" title="Name" name="name" />\r\n	<column type="text" title="Quantity" name="quantity" />\r\n</view>\r\nXML;\r\n\r\n			$view = new CView();\r\n			if ($view->Configure($xml))\r\n			{\r\n				$view->SetData($services);\r\n\r\n				$cache = $view->ToString();\r\n			}\r\n		}\r\n	}\r\n\r\n	$session->RegisterVariable(\'sitedetails\', $cache, false);\r\n\r\n}\r\nelse\r\n{\r\n	$cache .= \'<!-- from cache -->\';\r\n}\r\n\r\n\r\n$pageEx[\'raw\'] = $cache;\r\n\r\nreturn $pageEx;', NULL, 0, 0),
	('CBA80CADFF968627E8D950ABF2EC4265', '', '59B6AE21A61BD2A487EE1EE1A5634063', 'administrator', NULL, '', 'giveusyourfeedback.vesh', 'admin', 'Give us your feedback', NULL, NULL, NULL, NULL, 'page', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '$pageEx = array();\r\n\r\n$config = CEnvironment::GetMainApplication()->GetProperties();\r\n\r\n$do = CEnvironment::GetSubmittedVariable(\'do\');\r\n\r\n\r\nswitch ($do)\r\n{\r\n	case \'submitted\':\r\n\r\n		$from = CEnvironment::GetSubmittedVariable(\'from\');\r\n		$content = CEnvironment::GetSubmittedVariable(\'content\');\r\n\r\n		$mail = new CMail();\r\n\r\n		$mail->SetType(\'smtp\');\r\n		$mail->SetSMTPAuth(true);\r\n		$mail->SetSMTPHost($config[\'site\'][\'email\'][\'outbound\'][\'server\'][\'smtp\']);\r\n		$mail->SetSMTPLogin($config[\'site\'][\'email\'][\'outbound\'][\'address\']);\r\n		$mail->SetSMTPPassword($config[\'site\'][\'email\'][\'outbound\'][\'password\']);\r\n\r\n		$mail->SetFrom($config[\'site\'][\'email\'][\'outbound\'][\'address\'], $config[\'site\'][\'email\'][\'outbound\'][\'name\']);\r\n		$mail->AddTo(\'qa@premium.veshter.com\');\r\n\r\n		$mail->SetContentType(\'text/plain\');\r\n		$mail->SetSubject(\'Client Feedback\');\r\n\r\n		$mail->SetBody(CString::Format(\'%s said: %s\', $from, $content));\r\n		if($mail->Send())\r\n		{\r\n			$pageEx[\'raw\'] = <<< HTML\r\n			 <div class="ui-state-highlight ui-corner-all" style="padding: 0 .7em;">\r\n                    <span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>\r\n                    <strong>Feedback submitted:</strong>\r\n					Thank you for giving us your feedback!                \r\n                    \r\n            </div>\r\n			\r\n			\r\nHTML;\r\n		} else \r\n		{\r\n			$pageEx[\'raw\'] = <<< HTML\r\n						 <div class="ui-state-error ui-corner-all" style="padding: 0 .7em;">\r\n                    <span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span>\r\n                    <strong>Alert:</strong>\r\n					Feedback cannot be submitted at this time. Please try again later.                \r\n                    \r\n            </div>\r\nHTML;\r\n		}\r\n		break;\r\n	default:\r\n		\r\n			$xml = <<< XML\r\n			<form name="edit_this" template="block.form.simple" prefix_template_element="block.form.element" label_ok="Give feedback">\r\n		<tab name="Note Details">\r\n			<element type="hidden" name="do" value="submitted" readonly="yes"/>\r\n			<element type="hidden" name="datetime" value="[self.REQUEST_TIME]"/>\r\n			<element type="text" title="From" name="from" value="[user.name_first] [user.name_last]" description=""/>\r\n        	<element type="textarea" title="Feedback" name="content" value="" description="" style="width:99%" rows="3"/>\r\n		</tab>\r\n\r\n	</form>\r\nXML;\r\n\r\n			$form = new CForm();\r\n			if ($form->Configure($xml))\r\n			{\r\n				$pageEx[\'raw\'] = $form->ToString();\r\n				\r\n			}	\r\n			else\r\n			{	\r\n			$pageEx[\'raw\'] = \'Feedback form failed to configure\';\r\n			}\r\n			\r\n			\r\n		break;\r\n\r\n\r\n\r\n}\r\n\r\n$pageEx[\'raw\'];\r\nreturn $pageEx;\r\n', NULL, 0, 0),
	('0BA9262CE51B2955A4A9DD86755C55CB', '', NULL, 'administrator', NULL, '', 'page_edit.vesh', 'page', 'Page Manager', NULL, NULL, _binary '', NULL, 'manager', NULL, '<manager location="basiccontent" key="guid" flag_copy="flag_copy" >\r\n        <view orderby="folder,filename,title" template="block.view.admin.generic" where="type=\'page\'">\r\n                <column type="guid" title="ID" name="guid"/>\r\n                <column type="text" title="Title" name="title"/>                \r\n                <column type="link" title="Web Path" name="path" value="CONCAT(\'/content/\', realm, CASE WHEN folder!=\'\' AND folder IS NOT NULL THEN CONCAT(\'/\', folder) ELSE \'\' END, \'/\', filename)"/>\r\n                \r\n        </view>\r\n        <form name="edit_this" template="block.form.generic" prefix_template_element="block.form.element">\r\n                <tab name="Content">\r\n                        <element type="hidden" name="do" value="edited" readonly="yes"/>\r\n                        <element type="hidden" name="guid"/>\r\n                        <element type="hidden" name="type" value="page"/>\r\n\r\n                        <element type="text" title="Folder" name="folder" value=""  description="" validation="/^[0-9A-Za-z_\\/]*$/"/>\r\n	        <element type="text" title="File name" name="filename" value=""  description="" minlength="5" validation="/^[0-9A-Za-z_]+\\.[A-Za-z]+$/"/>\r\n                        <element type="text" title="Title" name="title" value="" description=""/>\r\n                        <element type="richtextarea" title="Body" name="part" value="" description="Main section of the page"/>\r\n                </tab>\r\n\r\n        		<tab name="Secondary Content">\r\n                        <element type="richtextarea" title="Body 2" name="part2" value="" description="Secondary section"/>\r\n                        <element type="richtextarea" title="Body 3" name="part3" value="" description="Secondary section"/>\r\n                        <element type="richtextarea" title="Body 4" name="part4" value="" description="Secondary section"/>\r\n                        \r\n                </tab>\r\n                <tab name="Tertiary Content">\r\n                		<element type="textarea" title="Body 5" name="part5" value="" description="Secondary section"/>\r\n                        <element type="textarea" title="Body 6" name="part6" value="" description="Secondary section"/>\r\n                        <element type="textarea" title="Body 7" name="part7" value="" description="Secondary section"/>\r\n                        <element type="textarea" title="Body 8" name="part8" value="" description="Secondary section"/>\r\n                </tab>\r\n\r\n                <tab name="Layout">\r\n	                <element type="combobox" title="Theme" name="wrapper" value="" options="guid,CONCAT(realm, \' - \', title)" location="basiccontent" where="type=\'theme\'" orderby="realm,title" limit="-1" description="" template="block.form.element.combobox.theme"/>\r\n                                <element type="text" title="Priority" name="priority" value="" />\r\n                </tab>\r\n                <tab name="META">\r\n                        <element type="textarea" title="Description" name="description" value="" description=""/>\r\n                        <element type="textarea" title="Keywords" name="keywords" value="" description=""/>\r\n                </tab>\r\n                <tab name="Security">\r\n                        <element type="combobox" title="Workgroup" name="workgroup" value="" options="codename,name" location="workgroup" where="1" orderby="name" limit="-1" description="" template="block.form.element.combobox.workgroup"/>\r\n                </tab>\r\n                <tab name="SysAdmin" workgroup="sysadmin">\r\n                        <element type="text" title="Realm" name="realm" value="general" description="Usually, this value is general, member or administrator but can be anything sensible"/>                       \r\n                        <element type="textarea" title="Premerge" name="part9" value="" description="" wrap="off" style="width:100%" rows="40" template="block.form.element.code"/>\r\n                        <element type="textarea" title="Postmerge" name="part10" value="" description="" wrap="off" style="width:100%" rows="40" template="block.form.element.code"/>\r\n                </tab>\r\n        </form>\r\n        <form name="delete_this" config="config.manager.form.generic.delete"/>\r\n</manager>\r\n', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('D8CF8884D45E7C6650B10921823CCED6', '', NULL, 'administrator', NULL, '', 'theme_edit.vesh', 'theme', 'Theme Manager', NULL, NULL, _binary '', NULL, 'manager', NULL, '<manager location="basiccontent" key="guid" flag_copy="flag_copy" >\r\n        <view orderby="title" template="block.view.admin.generic" where="type=\'theme\'">\r\n                <column type="guid" title="ID" name="guid"/>\r\n                <column type="text" title="Title" name="title"/>                \r\n                <column type="text" title="Priority" name="priority"/>\r\n                \r\n        </view>\r\n        <form name="edit_this" template="block.form.generic" prefix_template_element="block.form.element">\r\n                <tab name="Content">\r\n                        <element type="hidden" name="do" value="edited" readonly="yes"/>\r\n                        <element type="hidden" name="guid"/>\r\n                        <element type="random" name="filename"/>\r\n                        <element type="hidden" name="type" value="theme"/>\r\n\r\n                        <element type="text" title="Title" name="title" value="" description=""/>\r\n                        <element type="textarea" title="Body" name="part"  wrap="off" style="width:100%" rows="40" template="block.form.element.code" description="Main section of the theme"/>\r\n                </tab>\r\n\r\n        	<!--tab name="Secondary Content">\r\n                        <element type="richtextarea" title="Body 2" name="part2" value="" description="Secondary section"/>\r\n                        <element type="richtextarea" title="Body 3" name="part3" value="" description="Secondary section"/>\r\n                        <element type="richtextarea" title="Body 4" name="part4" value="" description="Secondary section"/>\r\n                </tab-->\r\n                <tab name="Tertiary Content">\r\n                       <element type="textarea" title="Body 5" name="part5" value="" description="Secondary section"/>\r\n                        <element type="textarea" title="Body 6" name="part6" value="" description="Secondary section"/>\r\n                        <element type="textarea" title="Body 7" name="part7" value="" description="Secondary section"/>\r\n                        <element type="textarea" title="Body 8" name="part8" value="" description="Secondary section"/>\r\n                </tab>\r\n                <tab name="Layout">\r\n	                <element type="combobox" title="Theme" name="wrapper" value="" options="guid,CONCAT(realm, \' - \', title)" location="basiccontent" where="type=\'theme\'" orderby="realm,title" limit="-1" description="" template="block.form.element.combobox.theme"/>\r\n                                <element type="combobox" title="Default" name="priority" value="" options="1:No^0:Yes" description="Select yes is this theme is the default for this site" template="block.form.element.combobox.withnochange" />\r\n                </tab>\r\n                <!--tab name="META">\r\n                        <element type="textarea" title="Description" name="description" value="" description=""/>\r\n                        <element type="textarea" title="Keywords" name="keywords" value="" description=""/>\r\n                </tab-->\r\n                <tab name="Security">\r\n                        <element type="combobox" title="Workgroup" name="workgroup" value="" options="codename,name" location="workgroup" where="1" orderby="name" limit="-1" description="" template="block.form.element.combobox.workgroup"/>\r\n                </tab>\r\n\r\n                <tab name="SysAdmin" workgroup="sysadmin">\r\n                        <element type="text" title="Realm" name="realm" value="general" description="Usually, this value is general, member or administrator but can be anything sensible"/>                       \r\n                        <element type="textarea" title="Premerge" name="part9" value="" description="" wrap="off" style="width:100%" rows="40" template="block.form.element.code"/>\r\n                        <element type="textarea" title="Postmerge" name="part10" value="" description="" wrap="off" style="width:100%" rows="40" template="block.form.element.code"/>\r\n                </tab>\r\n        </form>\r\n        <form name="delete_this" config="config.manager.form.generic.delete"/>\r\n</manager>\r\n', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('93EC3193F6C214EC5AAC70D5AC67EDF1', '', NULL, 'administrator', NULL, '', 'dialog_edit.vesh', 'sysadmin', 'Dialog Manager', NULL, NULL, _binary '', NULL, 'manager', NULL, '<manager location="basiccontent" key="guid" flag_copy="flag_copy">\r\n	<view mode="table" orderby="realm, category" template="block.view.admin.generic" where="type=\'dialog\'">\r\n		<column type="guid" title="GUID" name="guid"/>\r\n		<column type="text" title="Realm" name="realm"/>\r\n		<column type="text" title="Category" name="category" />\r\n		<column type="text" title="Title" name="title"/>\r\n		<column type="text" title="Url" name="stereotype" />\r\n	</view>\r\n	<form name="edit_this" template="block.form.generic" prefix_template_element="block.form.element">\r\n		<tab name="Info">\r\n			<element type="hidden" name="do" value="edited" readonly="yes"/>\r\n			<element type="hidden" name="guid"/>\r\n			<element type="random" name="filename"/>\r\n                    		<element type="hidden" name="type" value="dialog"/>\r\n\r\n			<element type="text" title="Realm" name="realm" value=""  description=""/>\r\n			<element type="text" title="Category" name="category" value=""  description=""/>\r\n			<element type="text" title="Workgroup" name="workgroup" value=""  description=""/>\r\n			<element type="text" title="Title" name="title" value=""  description=""/>\r\n\r\n		</tab>\r\n                <tab name="Configuration" workgroup="sysadmin">\r\n                       \r\n                        <element type="textarea" title="XML" name="part" value="" description="" wrap="off" style="width:100%" rows="40" />\r\n                </tab>\r\n	</form>\r\n	<form name="delete_this" config="config.manager.form.generic.delete"/>\r\n</manager>', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('D4F88EF79A220903456A369AC86ED5F3', '', NULL, 'administrator', NULL, '', 'dashboard.vesh', 'admin', 'Admin Dashboard', NULL, NULL, NULL, NULL, 'page', NULL, '', NULL, NULL, NULL, NULL, NULL, NULL, NULL, '$pageEx = array();\r\n\r\n\r\n$config = CEnvironment::GetMainApplication()->GetProperties();\r\n\r\n//CEnvironment::Dump($config);\r\n\r\nif (!empty($config[\'dashboard.url\']))\r\n{\r\n\r\n	$url = $config[\'dashboard.url\'];\r\n    $url_detailed = !empty($config[\'stats.url\']) ? $config[\'stats.url\'] :  $config[\'dashboard.url\'];\r\n    \r\n$pageEx[\'raw\'] = <<<HTML\r\n\r\n<div align=right>\r\n<a href="$url_detailed" target=dashboard>Click here for a detailed statistics</a>\r\n</div>\r\n\r\n<iframe src="$url" id="dashboard" width=100% height=1200 frameborder=0 scrolling=0></iframe>\r\n\r\n\r\n\r\n\r\nHTML;\r\n\r\n}\r\nelse\r\n{\r\n$pageEx[\'raw\'] = <<<HTML\r\n\r\n<h3>Web site statistics are not configured</h3>\r\n\r\nPlease contact your account representative to add this service.\r\n\r\n<p><img src="/images/misc/studio/samplestats.jpg">\r\n\r\nHTML;\r\n}\r\n\r\n\r\nreturn $pageEx;\r\n\r\n', NULL, 0, 0),
	('1A516A17E5D79D48EFDCB224C37FCE2F', '', '59B6AE21A61BD2A487EE1EE1A5634062', 'administrator', NULL, '', 'webpart_activitylog.vesh', 'admin', 'Activity Log', NULL, NULL, NULL, NULL, 'page', NULL, 'Log', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('12C16D2EE9C6A4F98938C8343B4D2C39', '', '59B6AE21A61BD2A487EE1EE1A5634063', 'administrator', NULL, '', 'referafriend.vesh', 'admin', 'Refer-a-friend', NULL, NULL, NULL, NULL, 'page', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '$pageEx = array();\r\n\r\n$config = CEnvironment::GetMainApplication()->GetProperties();\r\n\r\n$do = CEnvironment::GetSubmittedVariable(\'do\');\r\n\r\n\r\nswitch ($do)\r\n{\r\n	case \'submitted\':\r\n\r\n		$from = CEnvironment::GetSubmittedVariable(\'from\');\r\n\r\n		$to = CEnvironment::GetSubmittedVariable(\'to\');\r\n		$to_name = CEnvironment::GetSubmittedVariable(\'to_name\');\r\n		$to_email = CEnvironment::GetSubmittedVariable(\'to_email\');\r\n		$to_phone = CEnvironment::GetSubmittedVariable(\'to_phone\');\r\n		\r\n		$content = CEnvironment::GetSubmittedVariable(\'content\');\r\n\r\n		$mail = new CMail();\r\n\r\n		$mail->SetType(\'smtp\');\r\n		$mail->SetSMTPAuth(true);\r\n		$mail->SetSMTPHost($config[\'site\'][\'email\'][\'outbound\'][\'server\'][\'smtp\']);\r\n		$mail->SetSMTPLogin($config[\'site\'][\'email\'][\'outbound\'][\'address\']);\r\n		$mail->SetSMTPPassword($config[\'site\'][\'email\'][\'outbound\'][\'password\']);\r\n\r\n		$mail->SetFrom($config[\'site\'][\'email\'][\'outbound\'][\'address\'], $config[\'site\'][\'email\'][\'outbound\'][\'name\']);\r\n		$mail->AddTo(\'sales@veshter.com\');\r\n\r\n		$mail->SetContentType(\'text/plain\');\r\n		$mail->SetSubject(\'Client referral\');\r\n\r\n		$body = CString::Format("%s said: %s\\n", $from, $content);\r\n		$body .= "\\nFriend/colleague\\\'s information:\\n";\r\n		$body .= CString::Format("Name: %s\\n", $to);\r\n		$body .= CString::Format("Email: %s\\n", $to_email);\r\n		$body .= CString::Format("Phone: %s\\n", $to_phone);\r\n\r\n		$mail->SetBody($body);\r\n		\r\n		if($mail->Send())\r\n		{\r\n			$pageEx[\'raw\'] = <<< HTML\r\n			 <div class="ui-state-highlight ui-corner-all" style="padding: 0 .7em;">\r\n                    <span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>\r\n                    <strong>Referral submitted:</strong>\r\n					Thank you for referring your friend/colleague! We will follow up with them shortly.           \r\n                    \r\n            </div>\r\n			\r\n			\r\nHTML;\r\n		} else \r\n		{\r\n			$pageEx[\'raw\'] = <<< HTML\r\n				<div class="ui-state-error ui-corner-all" style="padding: 0 .7em;">\r\n                    <span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span>\r\n                    <strong>Alert:</strong>\r\n					Referral cannot be submitted at this time. Please try again later.                \r\n                    \r\n            </div>\r\nHTML;\r\n		}\r\n		break;\r\n	default:\r\n		\r\n			$xml = <<< XML\r\n	<form name="edit_this" template="block.form.simple" prefix_template_element="block.form.element" label_ok="Refer">\r\n		<tab name="Note Details">\r\n			<element type="hidden" name="do" value="submitted" readonly="yes"/>\r\n			<element type="hidden" name="datetime" value="[self.REQUEST_TIME]"/>\r\n			<element type="text" title="Your name" name="from" value="[user.name_first] [user.name_last]" description=""/>\r\n			<element type="text" title="Their name" name="to" value="" description=""/>\r\n			<element type="text" title="Their email address" name="to_email" value="" description=""/>\r\n			<element type="text" title="Their phone" name="to_phone" value="" description=""/>\r\n        	<element type="textarea" title="Message" name="content" value="" description="" style="width:99%" rows="3"/>\r\n		</tab>\r\n\r\n	</form>\r\nXML;\r\n\r\n			$form = new CForm();\r\n			if ($form->Configure($xml))\r\n			{\r\n				$pageEx[\'raw\'] = $form->ToString();\r\n				\r\n			}	\r\n			else\r\n			{	\r\n			$pageEx[\'raw\'] = \'Referral form failed to configure\';\r\n			}\r\n			\r\n			\r\n		break;\r\n\r\n\r\n\r\n}\r\n\r\n$pageEx[\'raw\'];\r\nreturn $pageEx;', NULL, 0, 0),
	('8F495A5B013086B43FB026DD65EA58B2', '', NULL, 'administrator', NULL, '', '8F495A5B013086B43FB026DD65EA58B2', NULL, 'Plain Text/Simple Theme', NULL, NULL, _binary '', NULL, 'theme', NULL, '[premerge.raw;htmlconv=no;noerr;protect=no][page.part;htmlconv=no;noerr;protect=no][postmerge.raw;htmlconv=no;noerr;protect=no]', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 0),
	('ea660bdb2bce40ceb60b5109c7716a11', '', '59B6AE21A61BD2A487EE1EE1A5634063', 'administrator', NULL, '', 'webpart_file_upload.vesh', 'file', 'File Upload Selector', NULL, NULL, _binary '', NULL, 'page', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '$pageEx = array();\r\n$prefix = \'\\/content\\/\';\r\n$realm = \'general\';\r\n\r\n$Folder = CEnvironment::GetSubmittedVariable(\'folder\');\r\n$Folder = preg_replace(CString::Format(\'/%s%s\\//i\', $prefix, $realm), \'\',  $Folder);\r\n\r\n$UploadPage = \'/content/administrator/file_upload_receiver.vesh\';\r\n$UploadChunkSize = 1048576; //maximum chunk size\r\n$MaximumTotalUpload =-1;\r\n$MaximumUpload = 10485760; //maximum individual file size\r\n$MaxConcurrentUploads = 2;\r\n$ResizeImage = \'true\';\r\n$ImageSize = 600;\r\n$Multiselect = \'true\';\r\n// filter the file selection\r\n$Filter = \'Images (*.jpg;*.gif)|*.jpg;*.gif|All Files (*.*)|*.*\';\r\n// display files in the uploader\r\n$AllowThumbnail = \'true\';\r\n// javascript function to call when all files have uploaded\r\n$JavascriptCompleteFunction = \'uploadComplete\';\r\n$MaxNumberToUpload = -1;\r\n\r\n	\r\n$args ="UploadPage=" . urlencode($UploadPage) . ",Folder=" .  urlencode($Folder) . ",UploadChunkSize=$UploadChunkSize,MaximumTotalUpload=$MaximumTotalUpload,MaximumUpload=$MaximumUpload,MaxConcurrentUploads=$MaxConcurrentUploads,ResizeImage=$ResizeImage,ImageSize=$ImageSize,Multiselect=$Multiselect,Filter=$Filter,AllowThumbnail=$AllowThumbnail,JavascriptCompleteFunction=" . urlencode($JavascriptCompleteFunction) . ",MaxNumberToUpload=$MaxNumberToUpload";\r\n\r\n$html = <<< HTML\r\n\r\n	<script type="text/javascript">\r\n		function uploadComplete()\r\n		{\r\n			$(\'#studioNotificationStatusValue\').text(\'Upload complete\');\r\n			$(\'#studioNotificationStatus\').show(\'blind\');\r\n		}\r\n\r\n		function newFolder()\r\n		{\r\n			var folder = prompt("Please enter a folder name (i.e. images):");\r\n			if (folder != null)\r\n			{\r\n				if (folder.search(/^[0-9A-Za-z_/]+$/) != -1)\r\n				{\r\n					window.location.href="/content/administrator/webpart_file_upload.vesh?folder=$Folder/" + folder;\r\n				}\r\n				else\r\n				{\r\n					alert("Folder name is invalid or contains invalid characters: " + folder);\r\n				}\r\n			}\r\n		}\r\n\r\n	</script>\r\n\r\n<strong>Folder:</strong> $Folder (<a href="javascript:newFolder()" id="newFolder"  title="Create a new folder"  class="webonly">New Folder</a>)\r\n\r\n\r\n\r\n\r\n\r\n<div style="height:400px">\r\n        <object data="data:application/x-silverlight-2," type="application/x-silverlight-2" style="width:100%; height:100%">\r\n			<param name="source" value="/static/bulkupload/1.0/FileUpload.xap"/>\r\n			<param name="background" value="white" />\r\n			<param name="minRuntimeVersion" value="2.0.31005.0" />\r\n			<param name="autoUpgrade" value="true" />\r\n			<param name="initParams" value="$args" />\r\n			<a href="http://go.microsoft.com/fwlink/?LinkID=124807" style="text-decoration: none;">\r\n     			<img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style: none"/>\r\n			</a>\r\n		</object>\r\n\r\n</div>\r\n\r\n\r\nHTML;\r\n\r\n$pageEx[\'raw\'] = $html;\r\n\r\nreturn $pageEx;', NULL, 0, 0),
	('8711EA72851688503DC7062285705C5B', '', NULL, 'general', NULL, '', 'log.vesh', 'any', 'Log In', NULL, NULL, _binary '', NULL, 'page', NULL, '<!--no content-->', NULL, NULL, NULL, NULL, NULL, NULL, NULL, '\r\n<?\r\n\r\n$pageEx = array();\r\n\r\n$application =  CEnvironment::GetMainApplication();\r\n\r\n$config = $application->GetProperties();\r\n\r\n$redirectUrl = CString::Format(\'%s?do=login\', CEnvironment::GetScriptUri());\r\n\r\n$provider = new CIdentityProviderGoogle($config[\'site\'][\'auth\'][\'clientid\'], $config[\'site\'][\'auth\'][\'clientsecret\'], $config[\'site\'][\'auth\'][\'developerkey\'], $redirectUrl);\r\n\r\n$do = CEnvironment::GetSubmittedVariable("do");\r\n\r\nswitch($do)\r\n{\r\n    case "beginAuth":\r\n	$url = $provider->GetAuthenticationUrl();\r\n            CEnvironment::RegisterHeader(CString::Format(\'location: %s\', $url));\r\n	exit;\r\n\r\n    case "login":\r\n\r\n	$code =  CEnvironment::GetSubmittedVariable("code");\r\n\r\n	$provider->Authenticate($code);\r\n	$user = $provider->GetUserIdentity();\r\n\r\n        $sentry = CEnvironment::GetMainApplication()->GetSentry();\r\n        if ($sentry->LoginActiveUser($user->GetLogin(), $user))\r\n        {\r\n\r\n\r\n            //try to send the user to the last page they were on.\r\n            $session = CEnvironment::GetMainApplication()->GetSession();\r\n            $url = $session->GetRegisteredVariable(\'url\', $config[\'studio\'][\'url\'][\'forward_login_success\']);\r\n\r\n            CEnvironment::RegisterHeader(CString::Format(\'location: %s\', $url));\r\n\r\n            exit;\r\n        }\r\n        else\r\n        {\r\n            throw new CExceptionSecurity(\'Login is not authorized to access this site: \' . $user->GetLogin() . \' Please provide this information to your webmaster.\');\r\n        }\r\n\r\n        break;\r\n    case "logout":\r\n        //CEnvironment::Dump($_SESSION);\r\n\r\n        $sentry = CEnvironment::GetMainApplication()->GetSentry();\r\n        $sentry->LogoutActiveUser();\r\n\r\n	$provider->RevokeToken();\r\n\r\n        //CEnvironment::Dump($_SESSION);\r\n\r\n        CEnvironment::RegisterHeader(CString::Format(\'location: %s?reason=loggedout&message=%s\', CEnvironment::GetScriptVirtualName(), \'User logged out\'));\r\n\r\n        break;\r\n\r\n    default:\r\n        $session = CEnvironment::GetMainApplication()->GetSession();\r\n\r\n        $url = CEnvironment::GetSubmittedVariable(\'url\', CEnvironment::GetRequestUri());\r\n        if (!preg_match(\'/^\\/log.vesh.*/i\', $url))\r\n        {\r\n	\r\n	$session->RegisterVariable(\'url\', $url);\r\n        }\r\n	else\r\n	{\r\n	            $session->UnregisterVariable(\'url\', $url);\r\n	}\r\n\r\n        break;\r\n}\r\n\r\n$message = "";\r\nif (!CString::IsNullOrEmpty($_REQUEST[\'message\'])) $message = "<div><strong><font color=\\"red\\">". $_REQUEST[\'message\'] . "</font></strong></div><div>&nbsp;</div>";\r\n\r\n$pageEx[\'raw\'] = <<< HTML\r\n\r\n$message\r\n\r\n<div><a href="?do=beginAuth">Click here to login in</a></div>\r\n\r\nHTML;\r\n\r\nreturn $pageEx;\r\n\r\n?>', NULL, 0, 0),
	('F4B2C9EB5BE940EBB42EDE3D57AA9A49', '', NULL, 'administrator', 'SysAdmin', '', 'F4B2C9EB5BE940EBB42EDE3D57AA9A49', 'sysadmin', 'Managers', NULL, NULL, _binary '', NULL, 'link', '', '/content/administrator/manager_edit.vesh', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('E4C3B16E70B4CED046B6C1780DC6CF0E', '', NULL, 'administrator', 'Core Tools', '', 'E4C3B16E70B4CED046B6C1780DC6CF0E', 'page', 'Pages', NULL, NULL, _binary '', NULL, 'link', '', '/content/administrator/page_edit.vesh', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('CF26B43C955DE1CFBDB34F6C2915092E', '', NULL, 'administrator', 'Core Tools', '', 'CF26B43C955DE1CFBDB34F6C2915092E', 'theme', 'Themes', NULL, NULL, _binary '', NULL, 'link', '', '/content/administrator/theme_edit.vesh', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('3e60acc9d473490fa56b64127aba9c4f', '', NULL, 'administrator', 'Core Tools', '', '3e60acc9d473490fa56b64127aba9c4f', 'file', 'Files', 'n/a', NULL, _binary '', NULL, 'link', '', '/content/administrator/file_edit.vesh', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('C5B3660C9D767156BF93E725F492008F', '', NULL, 'administrator', 'SysAdmin', '', 'C5B3660C9D767156BF93E725F492008F', 'sysadmin', 'Links', NULL, NULL, _binary '', NULL, 'link', '', '/content/administrator/link_edit.vesh', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('e0dbf130a1944c8c930c1dc7a2962daa', '', '59B6AE21A61BD2A487EE1EE1A5634063', 'administrator', NULL, '', 'unavailable.vesh', 'admin', 'Warning', NULL, NULL, NULL, NULL, 'page', NULL, 'Please click "OK" below to finish creating this entry. Once the entry is created, come back to this screen for more options.', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('0912AAC62A34D798971565B14EBD04A2', '', '59B6AE21A61BD2A487EE1EE1A5634063', 'administrator', NULL, '', 'newsletter_publish.vesh', 'newsletter', 'Publish newsletter', NULL, NULL, NULL, NULL, 'page', NULL, '', NULL, NULL, NULL, NULL, NULL, NULL, NULL, '$parentkey_name = CEnvironment::GetSubmittedVariable(\'parentkey\');\r\n$newsletter = CEnvironment::GetSubmittedVariable($parentkey_name);\r\n\r\nif (($parentkey_name != \'newsletter\') || empty($parentkey_name) || empty($newsletter))\r\n{\r\n	throw new CExceptionNotCOnfigured("Cannot hook publishing tools");\r\n}\r\n\r\n$do = CEnvironment::GetSubmittedVariable(\'do\');\r\n\r\n$article = CEnvironment::GetSubmittedVariable(\'article\');\r\n$ssl = CEnvironment::GetServerSSLProtocol();\r\n$protocol = empty($ssl) ? \'http\' : \'https\';\r\n$url_article = CString::Format(\'%s://%s%s?guid=%s\',\r\n$protocol,\r\n$_SERVER[\'HTTP_HOST\'],\r\n\'/content/general/newsletter_article.vesh\',\r\n$article);\r\n\r\nswitch ($do)\r\n{\r\n	case \'preview\':\r\n\r\n\r\n\r\n		//die(\'Sending \' . $newsletter . \' \' . $article);\r\n\r\n		$output = <<< HTML\r\n\r\n<a href="$url_article" target=preview>Preview Newsletter</a> before sending\r\n\r\n<form method="post" action="$action">\r\n	<input type="hidden" name="do" value="publish">\r\n	<input type="hidden" name="parentkey" value="$parentkey_name">\r\n	<input type="hidden" name="newsletter" value="$newsletter">\r\n	<input type="hidden" name="article" value="$article">\r\n	<input type=submit value="Send newsletter">\r\n</form>\r\nHTML;\r\n		\r\n		break;\r\n\r\n	case \'publish\':\r\n\r\n		$contents = file_get_contents($url_article);\r\n		\r\n\r\n		if (empty($contents))\r\n		{\r\n			throw new CExceptionInvalidData(\'Nothing to send\');\r\n		}\r\n\r\n		$datagrid = CEnvironment::GetMainApplication()->GetDataGrid();\r\n		\r\n		CEnvironment::WriteLine(\'Retrieving envelope information...\');\r\n\r\n		if ($datagrid->Select(\'newsletter INNER JOIN newsletter_article article ON newsletter.guid = article.newsletter\',\r\n		array(\'newsletter.title as title\', \'from_name\', \'from_email\', \'article.title as subject\' ),//\'article.part as body\'\r\n		CString::Format(\'article.guid=%s\', CString::Quote($article))))\r\n		{\r\n			$envelope = $datagrid->GetRow(0, false);\r\n		}\r\n		else\r\n		{\r\n			throw new CExceptionNotFound(\'Newsletter or newsletter article could not be located\');\r\n		}\r\n\r\n		//CEnvironment::Dump($datagrid->GetQuery());\r\n\r\n		CEnvironment::WriteLine(\'Sending messages...\');\r\n		\r\n		if ($datagrid->Select(\'newsletter_subscriber\', \'*\', CString::Format(\'newsletter=%s AND bad_email=%s AND status=%s\', CString::Quote($newsletter), CString::Quote(\'no\'), CString::Quote(\'active\')), \'-1\'))\r\n		{\r\n			$data = $datagrid->Get(false);\r\n\r\n			$total = count($data);\r\n\r\n			foreach ($data as $row)\r\n			{\r\n				CDaemon::Write(\'. \');\r\n				//don\'t send to people where there\r\n				if (!empty($row[\'email\']))\r\n				{\r\n					\r\n					\r\n\r\n					$doc = new CDocument(CString::Format(\'%s - %s\', $envelope[\'title\'], $envelope[\'subject\']), \'html\', false);\r\n					$doc->MergeField(\'subscriber\', $row);\r\n					$subject = $doc->ToString();\r\n					\r\n					//add the unsubscribe link\r\n					$url_unsubscribe = CString::Format(\'<p><center><a href="/content/general/newsletter.vesh?do=unsubscribe&newsletter=%s&subscriber=%s">Click here to unsubscribe</a></center>\', $newsletter, $row[\'guid\']);\r\n					\r\n					$doc = new CDocument($contents . $url_unsubscribe, \'html\', false);\r\n					$doc->RestorePseudoCode();\r\n					$doc->MergeField(\'subscriber\', $row);\r\n					$body = $doc->ToStringAbsoluteLinks();\r\n\r\n					//print($body);\r\n\r\n					$mail = new CMail();\r\n					$mail->SetContentType(\'text/html\');\r\n					$mail->SetFrom($envelope[\'from_email\'], $envelope[\'from_name\']);\r\n					$mail->SetSender(CString::Format(\'%s@bounced.contentsrvr.net\', base64_encode($envelope[\'from_email\'])));\r\n					$mail->SetSubject($subject);\r\n					$mail->SetBody($body);\r\n					//$mail->SetAltBody($envelope[\'body\']);\r\n\r\n					$mail->AddTo($row[\'email\']);\r\n					\r\n					$mail->Send();\r\n\r\n				}\r\n			}\r\n			\r\n			//update the lastsent timestamp for the article\r\n			$datagrid->Update(\'newsletter_article\', array(\'lastsent\'), array(time()), \r\n			CString::Format(\'newsletter=%s AND guid=%s\', CString::Quote($newsletter), CString::Quote($article)));\r\n						\r\n			CEnvironment::WriteLine(\'\');\r\n			CEnvironment::WriteLine(CString::Format(\'Process complete. Sent %d message(s)\', $total));\r\n			\r\n			\r\n\r\n		}\r\n		else\r\n		{\r\n			CEnvironment::WriteLine(\'No messages were sent because there are no subscribers\');\r\n		}\r\n\r\n		break;\r\n\r\n	default:\r\n		$datagrid = CEnvironment::GetMainApplication()->GetDataGrid();\r\n\r\n		if ($datagrid->Select(\'newsletter_article\', array(\'guid\', \'title\'), CString::Format(\'%s=%s\', $parentkey_name, CString::Quote($newsletter)),\'-1\', \'title\'))\r\n		{\r\n			$data = $datagrid->Get(false);\r\n\r\n			$articles = \'\';\r\n			foreach($data as $row)\r\n			{\r\n				$articles .= CString::Format(\'<option value="%s">%s</option>\', $row[\'guid\'], $row[\'title\']);\r\n			}\r\n\r\n			$action = CEnvironment::GetScriptVirtualName();\r\n			$output = <<< HTML\r\n<form method="post" action="$action">\r\n	<input type="hidden" name="do" value="preview">\r\n	<input type="hidden" name="parentkey" value="$parentkey_name">\r\n	<input type="hidden" name="newsletter" value="$newsletter">\r\n	<select name="article">\r\n		$articles\r\n	</select>\r\n	<input type=submit value="Select & Preview">\r\n\r\n</form>\r\nHTML;\r\n		}\r\n		\r\n		$output .= "Don\'t see an article? <a href=# onClick=\'window.location.href=window.location.href;\'>Click here</a> to refresh the listing.";\r\n		\r\n		\r\n		\r\n}\r\n\r\n\r\n//$datagrid = CEnvironment::GetMainApplication()->GetDataGrid();\r\n//CEnvironment::Dump($datagrid->GetDatabaseLink()->GetStatus());\r\n\r\nreturn array(\'raw\' => $output);', '', 0, 0),
	('C08B9FE5704173FBE9984ABD41D77A24', '', '25F2E825326B63D2F6FE0A10B1D13AD2', 'general', NULL, '', 'newsletter_article.vesh', 'any', 'Newsletter Article', NULL, NULL, NULL, NULL, 'page', NULL, '', NULL, NULL, NULL, NULL, NULL, NULL, NULL, '$guid = CEnvironment::GetSubmittedVariable(\'guid\');\r\n\r\n\r\n$newsletter = CEnvironment::GetSubmittedVariable(\'newsletter\');\r\n\r\n$datagrid = CEnvironment::GetMainApplication()->GetDataGrid();\r\n\r\nif ($datagrid->Select(\'newsletter_article\', array(\'title\', \'part\'), CString::Format(\'guid=%s\', CString::Quote($guid))))\r\n{\r\n	$data = $datagrid->GetRow(0, false);\r\n	return array(\'raw\' => $data[\'part\']);\r\n}\r\nelse\r\n{\r\n	//CEnvironment::Dump($datagrid->GetDatabaseLink()->GetStatus());\r\n	throw new CExceptionNotFound(\'Requested article is invalid\');	\r\n}\r\n', NULL, 0, 0),
	('A64DF60C0BAB8C7FCEDDF160D063B34E', '', NULL, 'general', NULL, '', 'newsletter.vesh', 'any', 'Newsletter Preferences', NULL, NULL, NULL, NULL, 'page', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '$do = CEnvironment::GetSubmittedVariable(\'do\');\r\n\r\nswitch($do)\r\n{\r\n	case \'subscribe\':\r\n\r\n		$newsletter = CEnvironment::GetSubmittedVariable(\'newsletter\');\r\n\r\n		$name_first = CEnvironment::GetSubmittedVariable(\'name_first\');\r\n		$name_last = CEnvironment::GetSubmittedVariable(\'name_last\');\r\n		$email = CEnvironment::GetSubmittedVariable(\'email\');\r\n\r\n		$datagrid = CEnvironment::GetMainApplication()->GetDataGrid();\r\n		\r\n		if ($datagrid->Insert(\'newsletter_subscriber\', array(\'guid\', \'newsletter\', \'name_first\', \'name_last\', \'email\'), array(CGuid::NewGuid()->ToString(), $newsletter, $name_first, $name_last, $email)))\r\n		{\r\n			return array(\'raw\' => \'Subscription successful\');\r\n		}\r\n		else\r\n		{\r\n			return array(\'raw\' => \'Subscription failed\');\r\n		}\r\n\r\n		break;\r\n	case \'unsubscribe\':\r\n		$newsletter = CEnvironment::GetSubmittedVariable(\'newsletter\');\r\n		$subscriber = CEnvironment::GetSubmittedVariable(\'subscriber\');\r\n\r\n		$datagrid = CEnvironment::GetMainApplication()->GetDataGrid();\r\n\r\n		if ($datagrid->Update(\'newsletter_subscriber\', array(\'status\'), array(\'inactive\'), CString::Format(\'guid=%s AND newsletter=%s\', CString::Quote($subscriber), CString::Quote($newsletter))))\r\n		{\r\n			return array(\'raw\' => \'Unsubscription successful\');\r\n		}\r\n		else\r\n		{\r\n			return array(\'raw\' => \'Unsubscription failed\');\r\n		}\r\n		break;\r\n	default:\r\n		$action = CEnvironment::GetScriptVirtualName();\r\n\r\n		$datagrid = CEnvironment::GetMainApplication()->GetDataGrid();\r\n\r\n		$options = \'\';\r\n		if ($datagrid->Select(\'newsletter\', array(\'guid\',\'title\'), \'workgroup=\\\'any\\\'\', \'-1\', \'title\'))\r\n		{\r\n			$data = $datagrid->Get(false);\r\n\r\n			foreach ($data as $row)\r\n			{\r\n				$options .= CString::Format(\'<option value="%s">%s</option>\', $row[\'guid\'], $row[\'title\']);\r\n			}\r\n		}\r\n\r\n		if ($options == \'\')\r\n		{\r\n			return array(\'raw\' => \'There are no newsletters at this time\');\r\n		}\r\n\r\n\r\n		$html = <<< HTML\r\nPlease fill out the following form to subscribe to our newsletter:\r\n\r\n<p><form action="$action" method="post">\r\n<input type="hidden" name="do" value="subscribe">\r\n<table>\r\n	<tr>\r\n		<td>Newsletter</td><td><select name="newsletter">$options</select></td>\r\n	</tr>\r\n	<tr>\r\n		<td>Your First Name</td><td><input type="text" name="name_first"></td>\r\n	</tr>\r\n	<tr>\r\n		<td>Your Last Name</td><td><input type="text" name="name_last"></td>\r\n	</tr>\r\n	<tr>\r\n		<td>Your Email Address</td><td><input type="text" name="email"></td>\r\n	</tr>\r\n	<tr>\r\n		<td></td><td><input type="submit" value="Subscribe"></td>\r\n	</tr>\r\n</table>\r\n\r\n</form>\r\n\r\nHTML;\r\n\r\n		return array(\'raw\' => $html);\r\n}\r\n\r\nreturn array(\'raw\' => \'Requested action is invalid\');\r\n\r\n\r\n', NULL, 0, 0),
	('55E0A9DD891B893C88E624F537194E1C', '', NULL, 'general', NULL, '', 'newsletter_article_listing.vesh', 'any', 'Newsletter Article Listing', NULL, NULL, NULL, NULL, 'page', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '$listing = \'\';\r\n\r\n$datagrid = CEnvironment::GetMainApplication()->GetDataGrid();\r\n\r\nif ($datagrid->Select(\'newsletter_article\', array(\'guid\',\'title\', \'lastsent\'), \'lastsent != 0 AND lastsent IS NOT NULL\', \'-1\', \'lastsent DESC\'))\r\n{\r\n	$data = $datagrid->Get(false);\r\n\r\n	foreach ($data as $row)\r\n	{\r\n		$date = new CDateTime($row[\'lastsent\']);\r\n		$listing .= CString::Format(\'<div>%s - <a href="newsletter_article.vesh?guid=%s">%s</a></div>\', $date->ToString(\'dS \\of F Y\'), $row[\'guid\'], $row[\'title\']);\r\n	}\r\n}\r\n\r\nreturn array(\'raw\' => $listing);\r\n', NULL, 0, 0),
	('ea660bdb2bce40ceb60b5109c7716a12', '', '8F495A5B013086B43FB026DD65EA58B2', 'administrator', NULL, '', 'file_upload_receiver.vesh', 'file', 'File Upload Receiver', NULL, NULL, _binary '', NULL, 'page', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '$pageEx = array();\r\n\r\n\r\n//  This is the most basic of scripts with no try catches\r\n$filename = CEnvironment::GetSubmittedVariable(\'filename\');\r\n\r\n$config = CEnvironment::GetMainApplication()->GetProperties();\r\n$datagrid = CEnvironment::GetMainApplication()->GetDataGrid();\r\n\r\nif (!CString::IsNullOrEmpty($filename))\r\n{\r\n\r\n\r\n\r\n	$folder = CEnvironment::GetSubmittedVariable(\'folder\');\r\n\r\n	$complete = CEnvironment::GetSubmittedVariable(\'Complete\', \'true\');\r\n	$complete = strtolower($complete) == \'true\' ? true : false;\r\n\r\n	$getBytes = CEnvironment::GetSubmittedVariable(\'GetBytes\', \'false\');\r\n	$getBytes = strtolower($getBytes) == \'true\' ? true : false;\r\n\r\n	$startByte = intval(CEnvironment::GetSubmittedVariable(\'StartByte\', 0));\r\n\r\n	$tempDir = $config[\'site\'][\'dir\'][\'temp\'];\r\n\r\n	if (!is_dir($tempDir))\r\n	{\r\n		throw new CExceptionNotFound(\'Invalid temporary directory\');\r\n	}\r\n\r\n\r\n	$filePath = CString::Format(\'%s%s.tmp\', $tempDir, sha1($folder . $filename));\r\n	$fileSize = 0;\r\n	if ($datagrid->Select(\'basiccontent\', \'length(image) as filesize\', CString::Format(\'folder=%s AND filename=%s AND type=%s\',\r\n	CString::Quote($folder),\r\n	CString::Quote($filename),\r\n	CString::Quote(\'binary\')),\r\n	1))\r\n	{\r\n		$fileSize = intval($datagrid->GetValue(0, \'filesize\', false));\r\n		//die($filesize);\r\n	}\r\n	//	else if(file_exists($filePath))\r\n	//	{\r\n	//		$fileSize = filesize($filePath);\r\n	//	}\r\n\r\n\r\n	if($getBytes)\r\n	{\r\n		$pageEx[\'raw\'] = $fileSize;\r\n	}\r\n	else\r\n	{\r\n		try\r\n		{\r\n			$input = file_get_contents (\'php://input\');\r\n\r\n			if($startByte > 0 && file_exists($filePath))\r\n			{\r\n				//$file = fopen($filePath,\'a\');\r\n\r\n				if ($datagrid->ExecQuery(CString::Format(\'UPDATE basiccontent SET image = CONCAT(image, %s) WHERE folder=%s AND filename=%s\',\r\n				CString::Quote($input),\r\n				CString::Quote($folder),\r\n				CString::Quote($filename)\r\n				)))\r\n				{\r\n					$file = fopen($filePath,\'a\');\r\n					fwrite($file,$input);\r\n					fclose($file);\r\n				}\r\n				else\r\n				{\r\n					//throw new CExceptionNotFound(\'Cannot append to database\');\r\n				}\r\n\r\n\r\n			}\r\n			else\r\n			{\r\n				//$file = fopen($filePath,\'w\');\r\n\r\n				//clean up old data\r\n				$datagrid->Delete(\'basiccontent\', CString::Format(\'folder=%s AND filename=%s AND type=%s\',\r\n				CString::Quote($folder),\r\n				CString::Quote($filename),\r\n				CString::Quote(\'binary\')));\r\n\r\n				//clean up old data\r\n				if ($datagrid->Insert(\'basiccontent\',\r\n				array(\'guid\', \'folder\', \'filename\', \'workgroup\', \'image\', \'type\'),\r\n				array(\r\n				CGuid::NewGuid()->ToString(),\r\n				$folder,\r\n				$filename,\r\n				CSentry::$workgroup_unrestrictedaccess,\r\n				$input,\r\n				\'binary\')))\r\n				{\r\n					$file = fopen($filePath,\'w\');\r\n					fwrite($file,$input);\r\n					fclose($file);\r\n				}\r\n				else\r\n				{\r\n					//throw new CExceptionNotFound(\'Cannot create new database entry\');\r\n				}\r\n			}\r\n\r\n			if($complete)\r\n			{\r\n				$data = array();\r\n				$meta = array();\r\n\r\n				//we are working with an image\r\n				if ($imagesize = getimagesize($filePath, $info))\r\n				{\r\n					$meta[\'width\'] = $imagesize[0];\r\n					$meta[\'height\'] = $imagesize[1];\r\n					$meta[\'type\'] = image_type_to_mime_type($imagesize[2]);\r\n				}\r\n				$data[\'meta_image\'] = CCollection::ToXMLWorker($meta, \'meta\');\r\n\r\n\r\n				$datagrid = CEnvironment::GetMainApplication()->GetDataGrid();\r\n\r\n				$success = false;\r\n				if ($datagrid->ExecQuery(CString::Format(\'UPDATE basiccontent SET meta_image = %s WHERE folder=%s AND filename=%s\',\r\n				CString::Quote($data[\'meta_image\']),\r\n				CString::Quote($folder),\r\n				CString::Quote($filename)\r\n				)))\r\n				{\r\n					$success = true;\r\n				}\r\n\r\n				//remove the temp file\r\n				unlink($filePath);\r\n\r\n/*\r\n				$mail = new CMail();\r\n\r\n				$mail->SetType(\'smtp\');\r\n				$mail->SetSMTPAuth(true);\r\n				$mail->SetSMTPHost($config[\'site\'][\'email\'][\'outbound\'][\'server\'][\'smtp\']);\r\n				$mail->SetSMTPLogin($config[\'site\'][\'email\'][\'outbound\'][\'login\']);\r\n				$mail->SetSMTPPassword($config[\'site\'][\'email\'][\'outbound\'][\'password\']);\r\n\r\n				$mail->SetSubject(\'Final upload status \' . $success);\r\n				$mail->SetContentType(\'text/plain\');\r\n				$mail->SetFrom($config[\'site\'][\'email\'][\'outbound\'][\'address\'], $config[\'site\'][\'email\'][\'outbound\'][\'name\']);\r\n				$mail->AddTo(\'dkolev@premium.veshter.com\');\r\n\r\n				$mail->SetBody($data[\'meta_image\']);\r\n				if ($mail->Send())\r\n				{\r\n\r\n				}\r\n				else\r\n				{\r\n					CDaemon::WriteLine(\'Send filed: \' . $mail->GetLastError());\r\n				}\r\n*/\r\n\r\n			}\r\n		}\r\n		catch (Exception $e)\r\n		{\r\n			echo \'Caught exception: \',  $e->getMessage(), "\\n";\r\n		}\r\n	}\r\n}\r\nelse\r\n{\r\n	throw new CExceptionNotFound(\'No file specified\');\r\n}\r\n\r\n/*\r\n$mail = new CMail();\r\n\r\n$mail->SetType(\'smtp\');\r\n$mail->SetSMTPAuth(true);\r\n$mail->SetSMTPHost($config[\'site\'][\'email\'][\'outbound\'][\'server\'][\'smtp\']);\r\n$mail->SetSMTPLogin($config[\'site\'][\'email\'][\'outbound\'][\'login\']);\r\n$mail->SetSMTPPassword($config[\'site\'][\'email\'][\'outbound\'][\'password\']);\r\n\r\n$mail->SetSubject(\'Partial upload status\');\r\n$mail->SetContentType(\'text/plain\');\r\n$mail->SetFrom($config[\'site\'][\'email\'][\'outbound\'][\'address\'], $config[\'site\'][\'email\'][\'outbound\'][\'name\']);\r\n$mail->AddTo(\'dkolev@premium.veshter.com\');\r\n\r\n$mail->SetBody(print_r($_REQUEST, true) . print_r($datagrid->GetDatabaseLink()->GetStatus()->GetMessages(), true));\r\nif ($mail->Send())\r\n{\r\n\r\n}\r\nelse\r\n{\r\n	CDaemon::WriteLine(\'Send filed: \' . $mail->GetLastError());\r\n}\r\n*/\r\n\r\nreturn $pageEx;\r\n', NULL, 0, 0),
	('91E9ADD59AD95065F1DB21E322F69EBA', '91E9ADD59AD95065F1DB21E322F69EBC', NULL, 'administrator', NULL, '', '91E9ADD59AD95065F1DB21E322F69EBA', 'file', 'File Uploader', NULL, NULL, _binary '', NULL, 'dialog', NULL, '<dialog name="uploader" width="700" height="550" modal="yes" template="block.dialog.admin.generic.invokable.iframe" url_icon="/static/images/icons/48x48/shapes_48.png">\r\n	<content><![CDATA[/content/administrator/file_upload.vesh]]>	</content>\r\n<callback name="Done"><![CDATA[\r\n\r\n//refresh the file listing\r\nlocation.reload(true)\r\n\r\n]]></callback>\r\n</dialog>\r\n', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('91E9ADD59AD95065F1DB21E322F69EBB', '', '59B6AE21A61BD2A487EE1EE1A5634063', 'administrator', NULL, '', 'file_upload.vesh', 'file', 'File Uploader', NULL, NULL, _binary '', NULL, 'page', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '$premerge = array();\r\n\r\n$type = CEnvironment::GetSubmittedVariable(\'type\', \'file\');\r\n\r\n$html = <<< HTML\r\n\r\n<script src="/static/jqueryTree/1.01/ui.tree.js" type="text/javascript"></script>\r\n<link href="/static/jqueryTree/1.01/ui.tree.css" rel="stylesheet"\r\n	type="text/css" media="screen" />\r\n\r\n<script type="text/javascript">\r\n<!--			\r\n$(document).ready( function() {\r\n	\r\n	$(\'#fileTree\').fileTree({ root: \'\', script: \'/content/administrator/webpart_resources.vesh\', folderEvent: \'click\', expandSpeed: 750, collapseSpeed: 750, multiFolder: false }, \r\n	function(file) { \r\n\r\n	},\r\n	function(dir) { \r\n		$(\'#uploader\').attr(\'src\', \'/content/administrator/webpart_file_upload.vesh?folder=\' + dir);\r\n		//$(\'#selectedpath\').text(dir);\r\n	});\r\n	\r\n	\r\n});\r\n//-->\r\n</script>\r\n\r\n<table style="width:100%">\r\n<tr>\r\n<td valign="top">\r\n<div id="fileTree"></div>\r\n\r\n</td>\r\n<td valign="top">\r\n<fieldset>\r\n<legend>Uploader</legend>\r\n<iframe style="width:100%; height:475px" id="uploader" name="uploader" frameborder=0></iframe>\r\n\r\n</fieldset>\r\n</td>\r\n</tr>\r\n</table>\r\n<div style="display:none">\r\nSelected path: <span id="selectedpath"></span>\r\n</div>\r\n\r\n\r\nHTML;\r\n\r\n\r\n$doc = new CDocument($html, \'html\', false);\r\n\r\n$doc->MergeField(\'type\', $type);\r\n\r\n$premerge[\'raw\'] = $doc->ToString();\r\n\r\nreturn $premerge;', NULL, 0, 0),
	('59B6AE21A61BD2A487EE1EE1A5634161', '', '59B6AE21A61BD2A487EE1EE1A5634062', 'administrator', NULL, '', 'webpart_storageusage.vesh', 'admin', 'Current Storage Usage', NULL, NULL, _binary '', NULL, 'page', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '\r\n$pageEx = array();\r\n\r\n$session = CEnvironment::GetMainApplication()->GetSession();\r\n\r\n$cache = $session->GetRegisteredVariable(\'storageusage\', null, false);\r\n\r\nif (CString::IsNullOrEmpty($cache))\r\n{\r\n	$cache = \'No balance found.\';\r\n\r\n	$config = CEnvironment::GetMainApplication()->GetProperties();\r\n\r\n	function GetDirectorySize($path)\r\n	{\r\n		$totalsize = 0;\r\n\r\n		//print (\'Looking in \' . $path . \'<br>\');\r\n		if ($handle = opendir ($path))\r\n		{\r\n			while (false !== ($file = readdir($handle)))\r\n			{\r\n				$nextpath = $path . \'/\' . $file;\r\n				if (($file != \'.\') && ($file != \'..\') && !is_link ($nextpath))\r\n				{\r\n					if (is_dir ($nextpath))\r\n					{\r\n						$totalsize += GetDirectorySize($nextpath);\r\n					}\r\n					elseif (is_file ($nextpath))\r\n					{\r\n						$totalsize += filesize ($nextpath);\r\n					}\r\n				}\r\n			}\r\n		}\r\n		closedir ($handle);\r\n		return $totalsize;\r\n\r\n	}\r\n\r\n	function GetStorageUsage()\r\n	{\r\n		$datagrid = CEnvironment::GetMainApplication()->GetDataGrid();\r\n\r\n		$datagrid->SetQuery(\'SHOW TABLE STATUS\');\r\n\r\n		$data = $datagrid->Get();\r\n\r\n		$total_db = 0;\r\n		if (count($data) > 0)\r\n		{\r\n			foreach ($data as $row)\r\n			{\r\n				$total_db += $row[\'Data_length\']+$row[\'Index_length\'];\r\n			}\r\n		}\r\n		$total_db_mb = round($total_db/1024/1024,2);\r\n\r\n		//safe mode doesn\'t allow ` executions\r\n		$total_file = GetDirectorySize(\'../../\');\r\n		$total_file_mb = round($total_file/1024/1024,2);\r\n\r\n\r\n		$properties = CEnvironment::GetMainApplication()->GetProperties();\r\n		$maxstorage = $properties[\'site\'][\'limit\'][\'storage\'];\r\n		$maxstorage_mb = round($maxstorage/1024/1024,2);\r\n\r\n		$total = $total_db + $total_file;\r\n\r\n		$percentfull = round(($total/$maxstorage)*100);\r\n\r\n		if ($percentfull == 0)\r\n		{\r\n			$percentfull = 1;\r\n		}\r\n\r\n		//if ($percentfull > 100)\r\n		//{\r\n		//	$percentfull = 100;\r\n		//}\r\n\r\n		$color = $percentfull > 90 ? "red" : "green" ;\r\n\r\n\r\n\r\n		//and $total_file_mb Mb in file storage\r\n		$usage = <<< HTML\r\n\r\n\r\n	<div title="Your web site uses $total_file_mb MB of file storage and $total_db_mb MB of database storage out of $maxstorage_mb MB available">\r\n	Storage $percentfull%\r\n	<br><table class="storage" width="150"><tr>\r\n	<td style="width: $percentfull%; background: $color; border: #808080 1px solid; ">&nbsp;</td>\r\n	<td style="background: #dddddd; height: 8px;">&nbsp;</td>\r\n	</tr>\r\n	</table>\r\n	</div>\r\n\r\nHTML;\r\n\r\n		return $usage;\r\n\r\n	}\r\n\r\n\r\n	$cache = GetStorageUsage();\r\n\r\n\r\n	$session->RegisterVariable(\'storageusage\', $cache, false);\r\n\r\n}\r\nelse\r\n{\r\n	$cache .= \'<!-- from cache -->\';\r\n}\r\n\r\n\r\n$pageEx[\'raw\'] = $cache;\r\n\r\nreturn $pageEx;', NULL, 0, 0),
	('5182124149AB7842DB0E4A8BD4C53417', '', '59B6AE21A61BD2A487EE1EE1A5634168', 'administrator', NULL, '', 'index.vesh', 'admin', 'Welcome to your administrative area', NULL, NULL, _binary '', NULL, 'page', NULL, '\r\n<script type="text/javascript">\r\n	<!--\r\n\r\n	$(document).ready(function() {\r\n\r\n		//ajax calls\r\n		$.post(\'/content/administrator/webpart_studionews.vesh\', \r\n			function(data){\r\n				$(\'#studioWebPartStudioNews\').html(data);\r\n				}\r\n		);\r\n		$.post(\'/content/administrator/webpart_randomtip.vesh\', \r\n			function(data){\r\n				$(\'#studioWebPartRandomTip\').html(data);\r\n				}\r\n		);\r\n		$.post(\'/content/administrator/webpart_trafficsummary.vesh\', \r\n			function(data){\r\n				$(\'#studioWebPartTrafficSummary\').html(data);\r\n				}\r\n		);\r\n\r\n		$.post(\'/content/administrator/webpart_sitedetails.vesh\', \r\n			function(data){\r\n				$(\'#studioWebPartSiteDetails\').html(data);\r\n				}\r\n		);\r\n/*\r\n		$.post(\'/content/administrator/webpart_supporttickets.vesh\', \r\n			function(data){\r\n				$(\'#studioWebPartSupportTickets\').html(data);\r\n				}\r\n		);\r\n\r\n		$.post(\'/content/administrator/webpart_activitylog.vesh\', \r\n			function(data){\r\n				$(\'#studioWebPartActivityLog\').html(data);\r\n				}\r\n		);\r\n*/\r\n	});\r\n\r\n	//-->\r\n	</script>\r\n\r\n\r\n<!--iframe src="http://stats.websitesettings.com/report1.cgi?profile=170221&rid=2148126&prefs=170221secure.veshter.com&gtype=5&spview=1&splist=|1102|&x=1"></iframe-->\r\n\r\n<div class="ui-widget">\r\n\r\n<div class="ui-corner-all" style="padding: 0"><!-- /content/administrator/dashboard.vesh -->\r\n<!--iframe src="http://stats.websitesettings.com/report1.cgi?profile=170221&rid=2148126&prefs=170221secure.veshter.com" id="studioContentFrame" name="studioContentFrame"  scrolling="auto" frameBorder="no" style="width:100%;height:700px"></iframe-->\r\n\r\n\r\n<table>\r\n	<tr>\r\n		<td width="50%" valign="top">\r\n\r\n\r\n\r\n\r\n\r\n		<div class="ui-state-secondary ui-corner-all" style="padding: 0 .7em;">\r\n		<p><span class="ui-icon ui-icon-pencil"\r\n			style="float: left; margin-right: .3em;"></span> <strong>Studio\r\n		News</strong></p>\r\n		<div class="studioWebpart" id="studioWebPartStudioNews"><img src="/static/images/spinner.gif"> Loading...</div>\r\n\r\n		<br>\r\n		</div>\r\n\r\n\r\n\r\n		<div class="ui-state-secondary ui-corner-all" style="padding: 0 .7em;">\r\n		<p><span class="ui-icon ui-icon-help"\r\n			style="float: left; margin-right: .3em;"></span> <strong>Did\r\n		you know?</strong></p>\r\n	\r\n		<div class="studioWebpart" id="studioWebPartRandomTip"><img src="/static/images/spinner.gif"> Loading...</div>\r\n		<br>\r\n		</div>\r\n\r\n		<div class="ui-state-secondary ui-corner-all" style="padding: 0 .7em;">\r\n		<p><span class="ui-icon ui-icon-clipboard"\r\n			style="float: left; margin-right: .3em;"></span> <strong>Website Contract Details</strong></p>\r\n	\r\n		<div class="studioWebpart" id="studioWebPartSiteDetails"><img src="/static/images/spinner.gif"> Loading...</div>\r\n		\r\n		\r\n		<br>\r\n		</div>\r\n\r\n		<!--div class="ui-state-secondary ui-corner-all" style="padding: 0 .7em;">\r\n		<p><span class="ui-icon ui-icon-person"\r\n			style="float: left; margin-right: .3em;"></span> <strong>Support\r\n		Center </strong></p>\r\n\r\n\r\n		<div>\r\n		<a href="javascript:jQueryEx.showIFrameDialog(\'contexthelp\', \'Support Center\', 790, 400, \'/content/administrator/supporttickets.vesh\', true, { \'Close\': function() { $(this).dialog(\'close\');}})">View/Edit Support Tickets</A> \r\n		or call [config.asp.phone]\r\n		</div>\r\n\r\n		<div class="studioWebpart" id="studioWebPartSupportTickets"><img src="/static/images/spinner.gif"> Loading...</div>\r\n\r\n		<br>\r\n		</div-->\r\n\r\n\r\n		\r\n\r\n		</td>\r\n\r\n\r\n		<td valign="top">\r\n\r\n		<div class="ui-state-secondary ui-corner-all" style="padding: 0 .7em;">\r\n		<p><span class="ui-icon ui-icon-clipboard"\r\n			style="float: left; margin-right: .3em;"></span> <strong>Website Traffic Summary</strong></p>\r\n\r\n		<div class="studioWebpart" id="studioWebPartTrafficSummary"><img src="/static/images/spinner.gif"> Loading...</div>\r\n\r\n		<br>\r\n		</div>\r\n\r\n		<!--div class="ui-state-secondary ui-corner-all" style="padding: 0 .7em;">\r\n		<p><span class="ui-icon ui-icon-comment"\r\n			style="float: left; margin-right: .3em;"></span> <strong>Give\r\n		us your feedback</strong></p>\r\n		\r\n		<a href="javascript:jQueryEx.showIFrameDialog(\'contexthelp\', \'Feedback\', 500, 400, \'/content/administrator/giveusyourfeedback.vesh\', true, { \'Close\': function() { $(this).dialog(\'close\');}})">Feedback</A> \r\n\r\n\r\n		<br>\r\n		</div-->\r\n\r\n\r\n\r\n		<!--div class="ui-state-secondary ui-corner-all" style="padding: 0 .7em;">\r\n		<p><span class="ui-icon ui-icon-star"\r\n			style="float: left; margin-right: .3em;"></span> <strong>Refer-a-friend</strong></p>\r\n\r\n		<a href="javascript:jQueryEx.showIFrameDialog(\'contexthelp\', \'Refer-a-friend\', 500, 400, \'/content/administrator/referafriend.vesh\', true, { \'Close\': function() { $(this).dialog(\'close\');}})">Refer a friend today!</A> \r\n		<br>\r\n		</div-->\r\n		\r\n		\r\n		\r\n		\r\n		\r\n\r\n		<!--div class="ui-state-secondary ui-corner-all" style="padding: 0 .7em;">\r\n		<p><span class="ui-icon ui-icon-note"\r\n			style="float: left; margin-right: .3em;"></span> <strong>Activity\r\n		Log</strong></p>\r\n\r\n		<div class="studioWebpart" id="studioWebPartActivityLog"><img src="/static/images/spinner.gif"> Loading...</div>\r\n\r\n		<br>\r\n		</div-->\r\n\r\n\r\n		</td>\r\n	</tr>\r\n</table>\r\n\r\n\r\n</div>\r\n</div>', '', '', NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('021D27DE34ABCED74DA8A4021CD05B9A', NULL, NULL, 'general', NULL, ' ', '021D27DE34ABCED74DA8A4021CD05B9A', NULL, 'XML Theme', NULL, NULL, _binary '', NULL, 'theme', NULL, '[premerge.raw;htmlconv=no;noerr]\r\n[page.part;htmlconv=no;noerr]\r\n[postmerge.raw;htmlconv=no;noerr]', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('59B6AE21A61BD2A487EE1EE1A5634063', '', NULL, 'administrator', NULL, '', '59B6AE21A61BD2A487EE1EE1A5634063', NULL, 'IFrame Theme', NULL, NULL, _binary '', NULL, 'theme', NULL, '<!doctype html>\r\n<html lang="en">\r\n<head>\r\n	<title>[page.title;noerr] - [config.site.name;noerr] - Powered by [config.studio.name;noerr]</title>\r\n\r\n	<meta http-equiv="X-UA-Compatible" content="IE=9" >\r\n	<meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">\r\n	<meta http-equiv="Pragma" content="no-cache">\r\n	\r\n	<link rel="shortcut icon" href="/static/favicon.ico">\r\n	<link type="text/css" href="/static/config.inc.css" rel="stylesheet" />\r\n	\r\n	<script type="text/javascript" src="/static/jquery-1.3.2.js"></script>\r\n\r\n	<script type="text/javascript" src="/static/jqueryUI/1.7.2/ui.jquery.js"></script>\r\n	<script type="text/javascript" src="/static/jqueryUI/extended.js"></script>\r\n	<link type="text/css" href="/static/jqueryUI/1.7.2/css/veshter/ui.jquery.css" rel="stylesheet" />\r\n\r\n	<script type="text/javascript" src="/static/jqueryTree/1.01/ui.tree.js"></script>\r\n	<link href="/static/jqueryTree/1.01/ui.tree.css" rel="stylesheet" type="text/css" media="screen" />\r\n\r\n	<script type="text/javascript" src="/static/config.inc.js"></script>\r\n\r\n	<script>\r\n	$(function() {\r\n		jQueryEx.initializeDialogContainer();\r\n	});\r\n\r\n	$(document).ready(function() {\r\n/*\r\n		$("#studioContent").hover(\r\n			 function () {\r\n				$(this).fadeTo(-1, 1);\r\n			 }, \r\n			function () {\r\n				$(this).fadeTo(1000, 0.33);\r\n     			}\r\n		);\r\n*/\r\n		$("#studioNotificationStatus").click(\r\n			function() 	{\r\n				$(this).hide(\'blind\');\r\n			}\r\n		);\r\n\r\n		$(\'#loading\').remove();\r\n		$(\'#studioPage\').removeClass(\'pseudohidden\');\r\n    	});\r\n		\r\n		\r\n	</script>\r\n	\r\n</head>\r\n<body>\r\n<div id="loading"><img src="/static/images/spinner.gif"> Loading...</div>\r\n<div id="studioPage" class="pseudohidden">\r\n     <div id="studioTopPrintable" class="printonly">\r\n	<div id="studioTitle">\r\n		[page.title;noerr] - [config.site.name;noerr]\r\n	</div>\r\n	<div>Printed by [user.name_first] [user.name_last] on [var..now;frm=\'yyyy-mm-dd hh:nn:ss\']  (Server time)</div>\r\n    </div>\r\n    <div class="wrapper" >\r\n       <div id="studioNotificationStatus" class="ui-widget webonly" [page.status;noerr;if [val] == \'\'; then \'style="display:none"\'; else \'\']>\r\n            <div class="ui-state-highlight ui-corner-all" style="padding: 0 .7em;">\r\n                <p>\r\n                    <span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>\r\n                    <strong>Action Status: </strong> \r\n                   <br><span id="studioNotificationStatusValue">[page.status;htmlconv=no;noerr]</span>\r\n            </div>\r\n       </div>\r\n        \r\n[premerge.raw;htmlconv=no;noerr;protect=no]\r\n\r\n[page.part;htmlconv=no;noerr;protect=no]\r\n\r\n[postmerge.raw;htmlconv=no;noerr;protect=no]\r\n       \r\n        \r\n   </div>       \r\n\r\n        \r\n\r\n </div>\r\n\r\n</body>\r\n</html>\r\n\r\n<!--This page was generated on [self.SERVER_NAME] at [var..now;frm=\'yyyy-mm-dd hh:nn:ss\']  (Server time)-->\r\n', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 0),
	('00a3e49b7ec6417b8ce399c61e03930f', '', 'df54b843175d47c0a959d0b7f30fa9d8', 'administrator', NULL, '', 'links.vesh', 'admin', 'Links', NULL, NULL, _binary '', NULL, 'page', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '', NULL, 0, 0),
	('0cbf48e7868a43c1add915d7a160aad5', '', NULL, 'administrator', NULL, '', 'profile_edit.vesh', 'profile', 'Profile Manager', NULL, NULL, _binary '', NULL, 'manager', NULL, '<manager location="profile" key="guid" flag_copy="flag_copy">\r\n        <view orderby="name_last,name_first,status" template="block.view.admin.generic"  where="su!=\'yes\'">\r\n                <column type="guid" title="ID" name="guid" />\r\n                <column type="text" title="First Name" name="name_first"/> \r\n                <column type="text" title="Last Name" name="name_last"/> \r\n                <column type="guid" title="Login/Profile Address" name="login" />\r\n	<column type="text" title="Status" name="status" />\r\n\r\n\r\n\r\n        </view>\r\n        <form name="edit_this" template="block.form.generic" prefix_template_element="block.form.element">\r\n            <tab name="Details">\r\n	            <element type="hidden" name="do" value="edited" readonly="yes"/>\r\n            	            <element type="hidden" name="su" value="no"/>\r\n	            <element type="hidden" name="guid"/>\r\n	            <element type="text" title="First Name" name="name_first" value="" description="This field will be updated automatically when the user logs in"/>\r\n            	            <element type="text" title="Last Name" name="name_last" value=""  description="This field will be updated automatically when the user logs in"/>\r\n            	            <element type="text" title="Login" name="login" value=""  description="Google User ID prefixed with \'eid-\'. For example \'eid-103231301933729284000\'"/>\r\n            	            <element type="combobox" title="Status" name="status" value="active" options="new:New^active:Active^expired:Expired^suspended:Suspended^deleted:Deleted" description=""/>\r\n        		\r\n            </tab>\r\n		<tab name="Privileges">\r\n			<element type="imanager" title="Privileges" name="profile_privilege" value="" description="Activities/resources this user has access to" style="width:100%; height:400px" href="profile_privilege_edit.vesh" parentkey="profile"/>\r\n		</tab> \r\n		</form>\r\n        <form name="delete_this" config="config.manager.form.generic.delete"/>\r\n	<eraser>\r\n		<child location="profile_privilege" foreignkey="profile"/>\r\n	</eraser>\r\n</manager>', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('a727baceed7b438b9067671420c79ab3', '', NULL, 'administrator', 'Core Tools', '', 'a727baceed7b438b9067671420c79ab3', 'profile', 'Users', NULL, NULL, _binary '', NULL, 'link', '', '/content/administrator/profile_edit.vesh', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('df54b843175d47c0a959d0b7f30fa9d5', '', '021D27DE34ABCED74DA8A4021CD05B9B', 'administrator', NULL, '', 'webpart_resources.vesh', 'admin', 'Resources', NULL, NULL, _binary '', NULL, 'page', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '$prefix = \'/content/\';\r\n$realm = \'general\';\r\n\r\n$pageEx = array();\r\n\r\n$dir = CEnvironment::GetSubmittedVariable(\'dir\');\r\n$type = CEnvironment::GetSubmittedVariable(\'type\', \'file\');\r\n$type_filter = \'1\';\r\nswitch($type)\r\n{\r\n	case \'image\':\r\n		$type_filter = \'filename REGEXP "\\.[gif|jpg|jpeg|png]+$"\';\r\n		break;\r\n	default:\r\n		break;\r\n\r\n}\r\n\r\n//make the path relative\r\n$dir = preg_replace(\'/^\\/content\\/general\\//\', \'\', $dir);\r\n\r\n$dirs = array();\r\n$files = array();\r\n\r\n$datagrid = CEnvironment::GetMainApplication()->GetDataGrid();\r\n\r\nif ($datagrid->Select(\'basiccontent\',\r\narray(\'realm\', \'folder\',\'filename\'),\r\nCString::Format(\'realm = %s AND (type="binary" OR type="page") AND folder REGEXP %s AND %s\', CString::Quote($realm), CString::Quote(CString::Format(\'^%s[/]?[A-Za-z0-9_]*$\', $dir)), $type_filter),\r\n-1, \'folder,filename\', null, true))\r\n{\r\n	$data = $datagrid->Get(false);\r\n\r\n	//CEnvironment::Dump($data);\r\n\r\n	$visited = array();\r\n\r\n	if (count($data) > 0)\r\n	{\r\n		foreach ($data as $row)\r\n		{\r\n			if (!in_array($row[\'folder\'], $visited) && ($row[\'folder\'] != $dir))\r\n			{\r\n				$folderTree = explode(\'/\', $row[\'folder\']);\r\n				$folder = $folderTree[count($folderTree)-1];\r\n				$dirs[] = array(\'path\' => CString::Format(\'%s%s/%s\', $prefix, $realm, $row[\'folder\']), \'name\' => $folder);\r\n				$visited[] = $row[\'folder\'];\r\n			}\r\n\r\n			if ($row[\'folder\'] == $dir)\r\n			{\r\n				$ext = preg_replace(\'/^.*\\./\', \'\', $row[\'filename\']);\r\n				if (!CString::IsNullOrEmpty($row[\'folder\']))\r\n				{\r\n					$path = CString::Format(\'%s%s/%s/%s\', $prefix, $realm, $row[\'folder\'], $row[\'filename\']);				\r\n				}\r\n				else\r\n				{\r\n					$path = CString::Format(\'%s%s/%s\', $prefix, $realm, $row[\'filename\']);			\r\n				}\r\n				$files[] = array(\'path\' => $path, \'name\' => $row[\'filename\'], \'ext\' => $ext);\r\n			}\r\n		}\r\n	}\r\n}\r\n\r\n\r\n//CEnvironment::Dump($datagrid->GetDatabaseLink()->GetStatus()->GetLastMessage());\r\n\r\n//CEnvironment::Dump($dirs);\r\n//CEnvironment::Dump($files);\r\n\r\n\r\n$doc = new CDocument(\'block.tree.generic\', \'html\');\r\n\r\n$doc->MergeBlock(\'dirs\', $dirs);\r\n$doc->MergeBlock(\'files\', $files);\r\n\r\n\r\n$pageEx[\'raw\'] = $doc->ToString();\r\n\r\n\r\nreturn $pageEx;', NULL, 0, 0),
	('df54b843175d47c0a959d0b7f30fa9d2', '', '59B6AE21A61BD2A487EE1EE1A5634063', 'administrator', NULL, '', 'resource_browse.vesh', 'admin', 'Resource browser', NULL, NULL, _binary '', NULL, 'page', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '$premerge = array();\r\n\r\n$type = CEnvironment::GetSubmittedVariable(\'type\', \'file\');\r\n\r\n$html = <<< HTML\r\n\r\n<script src="/static/jqueryTree/1.01/ui.tree.js" type="text/javascript"></script>\r\n<link href="/static/jqueryTree/1.01/ui.tree.css" rel="stylesheet"\r\n	type="text/css" media="screen" />\r\n\r\n<script type="text/javascript">\r\n<!--			\r\n$(document).ready( function() {\r\n	\r\n	$(\'#fileTree\').fileTree({ root: \'\', script: \'/content/administrator/webpart_resources.type_[type].vesh\', folderEvent: \'click\', expandSpeed: 750, collapseSpeed: 750, multiFolder: false }, \r\n	function(file) { \r\n		if ($(\'#showpreview\').attr(\'checked\'))\r\n		{\r\n			$(\'#preview\').attr(\'src\', file);\r\n		}\r\n		$(\'#selectedpath\').text(file);\r\n	},\r\n	function(dir) { \r\n		//$(\'#selectedpath\').text(dir);\r\n	});\r\n	\r\n	\r\n});\r\n//-->\r\n</script>\r\n\r\n<table style="width:100%">\r\n<tr>\r\n<td valign="top">\r\n<div id="fileTree"></div>\r\n\r\n</td>\r\n<td valign="top">\r\n<fieldset>\r\n<legend><input type="checkbox" id="showpreview" name="showpreview" checked="yes"/> Preview</legend>\r\n<iframe style="width:100%; height:450px" id="preview" name="preview" frameborder=0></iframe>\r\n\r\n</fieldset>\r\n</td>\r\n</tr>\r\n</table>\r\n<div style="display:none">\r\nSelected path: <span id="selectedpath"></span>\r\n</div>\r\n\r\n\r\nHTML;\r\n\r\n\r\n$doc = new CDocument($html, \'html\', false);\r\n\r\n$doc->MergeField(\'type\', $type);\r\n\r\n$premerge[\'raw\'] = $doc->ToString();\r\n\r\nreturn $premerge;', NULL, 0, 0),
	('8DA2E884D0182ED3EE644E6E4C32453D', '', NULL, 'general', NULL, '', 'admin', 'any', 'Forwarder to admin area', NULL, NULL, NULL, NULL, 'page', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 'header(\'location: /content/administrator/index.vesh\');\r\nexit;', NULL, 0, 0),
	('c03d16e2ffce4bbc880f01572255d574', '', '59B6AE21A61BD2A487EE1EE1A5634063', 'administrator', NULL, '', 'profile_privilege_edit.vesh', 'profile', 'Profile Privilege Manager', NULL, NULL, _binary '', NULL, 'manager', NULL, '<manager location="profile_privilege" key="guid" flag_copy="flag_copy"><!--  value="$id" where="id=\'$id\'" -->\r\n	<view orderby="workgroup" template="block.view.admin.generic" where="[parent.keyname]=\'[parent.keyvalue]\'"><!--  value="$id"  -->\r\n		<column type="guid" title="ID" name="guid"/>\r\n       	<column type="guid" title="Workgroup" name="workgroup" options="name" location="workgroup" key="guid"/>\r\n	</view>\r\n	<form name="edit_this" template="block.form.generic" prefix_template_element="block.form.element">\r\n		<tab name="Subscriber">\r\n			<element type="hidden" name="do" value="edited" readonly="yes"/>\r\n			<element type="hidden" name="guid"/>\r\n			<element type="hidden" name="profile"/>\r\n		 	<element type="combobox" title="Workgroup" name="workgroup" value="" options="guid,name" location="workgroup" where="1" orderby="name" limit="-1" description=""/>\r\n		</tab>\r\n	</form>\r\n	<form name="delete_this" config="config.manager.form.generic.delete"/>\r\n</manager>', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('7A17A0A8A694FD354C4356BC2A8B3C9B', '', '59B6AE21A61BD2A487EE1EE1A5634063', 'administrator', NULL, '', 'addfunds.vesh', 'admin', 'Add funds to your account', NULL, NULL, _binary '', NULL, 'page', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '$application =  CEnvironment::GetMainApplication();\r\n\r\n$config = $application->GetProperties();\r\n\r\n$client = CString::Format(\'%s-%s\', $config[\'site\'][\'client\'][\'id\'], $config[\'site\'][\'id\']);\r\n\r\n$catalog_email = $config[\'asp\'][\'email\'][\'billing\'][\'address\'];\r\n\r\n$amount = CEnvironment::GetSubmittedVariable(\'amount\');\r\n\r\nif ($amount < 0)\r\n{\r\n	$amount = \'\';\r\n}\r\n\r\n\r\n$message = <<< HTML\r\n <div class="ui-widget webonly">\r\n            <div class="ui-state-highlight ui-corner-all" style="padding: 0 .7em;">\r\n                <p>\r\n\r\n                    <span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>\r\n                    <strong>No balance currently due:</strong> <span id="studioNotificationInfoValue">This site does not have a balance. Adding funds will result in a credit.</span></p>\r\n            </div>\r\n        </div>\r\n\r\nHTML;\r\n\r\n$html = <<< HTML\r\n\r\n<center>\r\n<table style="width:400px; height:400px">\r\n<form action="https://www.paypal.com/cgi-bin/webscr"  method="post">\r\n<input type="hidden" name="cmd" value="_xclick">\r\n<input type="hidden" name="business" value="$catalog_email">\r\n<input type="hidden" name="item_name" value="Service Bill Payment">\r\n<input type="hidden" name="no_shipping" value="1">\r\n<!--input type="hidden" name="return" value="http://www.veshter.com/thankyou.vesh"-->\r\n<!--input type="hidden" name="cancel_return" value="http://www.veshter.com/thankyou.vesh"-->\r\n<input type="hidden" name="on0" value="Account Number">\r\n<input type="hidden" name="os0" value="$client">\r\n<input type="hidden" name="tax" value="0.00"> \r\n<input type="hidden" name="shipping" value="0.00"> \r\n \r\n<tr>\r\n<td valign="middle" align="center">\r\n<table>\r\n<tr>\r\n	<td>Amount to add:\r\n	</td>\r\n	<td rowspan="4">\r\n<!-- Begin Official PayPal Seal -->\r\n<A\r\n	HREF="https://www.paypal.com/verified/pal=$catalog_email"\r\n	target="_blank"><IMG\r\n	SRC="http://images.paypal.com/images/verification_seal.gif" BORDER="0"\r\n	ALT="Official PayPal Seal"></A>\r\n<!-- End Official PayPal Seal -->\r\n	</td>\r\n</tr>\r\n<tr>\r\n	<td><input type="textbox" name="amount" value="$amount"/>\r\n	</td>\r\n</tr>\r\n<tr>\r\n	<td><input type="submit" value="Proceed to secure server"/>\r\n	<br><img src=http://www.paypal.com/images/powered_by.gif border=0>\r\n	</td>\r\n</tr>\r\n</table>\r\n</td>\r\n</tr>\r\n</form>\r\n</table>\r\n\r\n</center>\r\n\r\nHTML;\r\n\r\n\r\nreturn array(\'raw\' => $amount > 0 ? $html : $message . $html);', NULL, 0, 0),
	('ff0007828f0b4c3e86550e746f9158f1', '', '59B6AE21A61BD2A487EE1EE1A5634063', 'administrator', NULL, '', 'newsletter_subscriber_update.vesh', 'newsletter', 'Newsletter Subscriber Update', NULL, NULL, NULL, NULL, 'page', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '\r\n$pageEx = array();\r\n\r\n$janitor = new CJanitor(\'Newsletter updater\');\r\n\r\n$action = CEnvironment::GetScriptVirtualName();\r\n\r\n$xml = <<<XML\r\n<form template="block.form.simple" action="$action" prefix_template_element="block.form.element" method="Post">\r\n	<tab name="List of emails">\r\n		<element type="hidden" name="do" value="send" />\r\n		<element type="combobox" title="Newsletter" name="newsletter" options="guid,title" location="newsletter" where="1" orderby="title" limit="-1" description=""/>\r\n		<element type="textarea" title="Raw List Data" name="raw_text_data" cols="50" rows="20" wrap="off" description="Format (comma-separated): name_first,name_last,organization,emailaddress" style="width:100%"/>\r\n	</tab>\r\n</form>\r\nXML;\r\n\r\n\r\n$form = new CForm();\r\n\r\n\r\nif($form->Configure($xml))\r\n{\r\n\r\n	$do = CEnvironment::GetSubmittedVariable(\'do\');\r\n\r\n	switch ($do)\r\n	{\r\n\r\n		case \'send\':\r\n				\r\n			if ($form->ValidateData())\r\n			{\r\n\r\n				$each = explode(\'\r\n\', CEnvironment::GetSubmittedVariable(\'raw_text_data\'));\r\n				if(count($each) > 0)\r\n				{\r\n\r\n					$datagrid = CEnvironment::GetMainApplication()->GetDataGrid();\r\n\r\n					$success = 0;\r\n					$exists = 0;\r\n					$invalid = 0;\r\n					$newsletters = CEnvironment::GetSubmittedVariable(\'newsletter\');\r\n					$newsletter = $newsletters[0];\r\n										\r\n					//CEnvironment::WriteLine(\'Working with newsletter \' . $newsletter);\r\n\r\n					$databasehelper = new CDatabaseHelper();\r\n\r\n					$databasehelper->SetLocation(\'newsletter_subscriber\');\r\n					\r\n\r\n					foreach($each as $each_v)\r\n					{\r\n						$line = trim($each_v);\r\n						$line_revised = explode(\',\', $line);\r\n\r\n						if(@count($line_revised) >= 3)\r\n						{\r\n\r\n							\r\n							if(!$datagrid->Select(\'newsletter_subscriber\',\'*\', CString::Format(\'email=%s AND newsletter=%s\', CString::Quote(trim($line_revised[3])), CString::Quote($newsletter)),\'1\'))\r\n							{\r\n								$databasehelper->SetKeys(array(\'guid\',\'name_first\',\'name_last\',\'org\',\'email\',\'newsletter\'));\r\n								$databasehelper->SetValues(array(CGuid::NewGuid()->ToString(),trim($line_revised[0]),trim($line_revised[1]),trim($line_revised[2]),trim($line_revised[3]),$newsletter));\r\n								\r\n								$datagrid->Insert($databasehelper->GetLocation(), $databasehelper->GetKeys(), $databasehelper->GetValues());\r\n								$success++;\r\n							}\r\n							else\r\n							{\r\n								$databasehelper->SetKeys(array(\'name_first\',\'name_last\',\'org\',\'newsletter\'));\r\n								$databasehelper->SetValues(array(trim($line_revised[0]),trim($line_revised[1]),trim($line_revised[2]),$newsletter));\r\n								\r\n								$datagrid->Update($databasehelper->GetLocation(), $databasehelper->GetKeys(), $databasehelper->GetValues(), CString::Format(\'email=%s\', CString::Quote($line_revised[3])));\r\n								\r\n								$exists++;\r\n\r\n							}\r\n\r\n						}\r\n						else\r\n						{\r\n\r\n							$invalid++;\r\n\r\n						}\r\n\r\n					}\r\n\r\n\r\n					$janitor->Notify(CString::Format(\'Operation completed. %d existing entries, %d successful entries, %d failed entries.\', $exists, $success, $invalid));\r\n\r\n\r\n				}\r\n				else\r\n				{\r\n\r\n					$janitor->Warn(\'No information Received\');\r\n\r\n				}\r\n			}\r\n			else\r\n			{\r\n				$janitor->Warn(\'Received information failed to validate\');\r\n			}\r\n			break;\r\n\r\n	}\r\n\r\n	$pageEx[\'raw\'] = $form->ToString();\r\n	\r\n	if (!empty($do))\r\n	{\r\n		$message = $janitor->GetStatus()->GetLastMessage();\r\n		$pageEx[\'raw\'] = CString::Format (\'%s<p>%s</p>\', $message[\'msg\'], $pageEx[\'raw\']);\r\n	}\r\n\r\n\r\n}\r\nelse\r\n{\r\n	$pageEx[\'raw\'] = \'Updater failed Configuration\';\r\n}\r\n\r\nreturn $pageEx;\r\n', NULL, 0, 0),
	('4a71076d9a38410bbcbc880cc79663da', '', '59B6AE21A61BD2A487EE1EE1A5634063', 'administrator', NULL, '', 'workgroup_edit.vesh', 'profile', 'Workgroup Manager', NULL, NULL, _binary '', NULL, 'manager', NULL, '<manager location="workgroup" key="guid" flag_copy="flag_copy">\r\n        <view orderby="name" template="block.view.admin.generic" where="1">\r\n                <column type="guid" title="ID" name="guid" />\r\n                <column type="text" title="Name" name="name"/> \r\n        </view>\r\n        <form name="edit_this" template="block.form.simple" prefix_template_element="block.form.element">\r\n            <tab name="Details">\r\n	            <element type="hidden" name="do" value="edited" readonly="yes"/>\r\n	            <element type="hidden" name="guid"/>\r\n				<element type="text" title="Code Name" name="codename" value="" description="Codenames are usually unique, single-string values that identify the workgroup"/>\r\n				<element type="text" title="Name" name="name" value="" description="Friendly name for the workgroup"/>\r\n            </tab>\r\n		<tab name="Notes">\r\n			<element type="text" title="Notes" name="notes" value="" description="Notes" style="width:100%; height:600" />\r\n		</tab> \r\n		</form>\r\n        <form name="delete_this" config="config.manager.form.generic.delete"/>\r\n	<eraser>\r\n		<child location="profile_privilege" foreignkey="workgroup"/>\r\n	</eraser>\r\n</manager>', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('396E617BAFB7D7634BD9D90AD650E83B', '', NULL, 'general', NULL, '', '396E617BAFB7D7634BD9D90AD650E83B', NULL, 'Error Theme', NULL, NULL, _binary '', NULL, 'theme', NULL, '<!doctype html>\r\n<html lang="en" >\r\n<head>\r\n<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">\r\n<title>[page.title;noerr]</title>\r\n\r\n<meta http-equiv="X-UA-Compatible" content="IE=9" >\r\n\r\n<link rel="shortcut icon" href="/static/favicon.ico">\r\n<link type="text/css" href="/static/config.inc.css" rel="stylesheet" />\r\n\r\n</head>\r\n\r\n<body>\r\n\r\n<!-- using generic theme. Custom theme was not found -->\r\n\r\n       \r\n        <div class="ui-widget">\r\n            <div class="ui-state-error ui-corner-all" style="padding: 0 .7em;">\r\n                <p>\r\n\r\n                    <span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span>\r\n                    <strong>[page.title;noerr]:</strong> [premerge.message;noerr]</p>\r\n            </div>\r\n        </div>\r\n\r\n\r\n<div class="ui-widget">\r\n            <div class="ui-state-active ui-corner-all" style="padding: 0 .7em;">\r\n\r\n[premerge.raw;htmlconv=no;noerr]\r\n\r\n[page.part;htmlconv=no]\r\n\r\n[postmerge.raw;htmlconv=no;noerr]\r\n                \r\n                    \r\n            </div>\r\n       </div>\r\n\r\n\r\n\r\n\r\n\r\n<!-- current page: [self.SCRIPT_VIRTUAL_NAME] -->\r\n\r\n</body>\r\n\r\n</html>\r\n\r\n', NULL, NULL, NULL, NULL, NULL, NULL, NULL, '$pageEx = array();\r\n\r\n$pageEx[\'message\'] = CEnvironment::GetSubmittedVariable(\'message\', \'Unknown error\');\r\n\r\nreturn $pageEx;', NULL, 1, 0),
	('E75DE2D1E2BDC04F4404136FEDB94F1D', '', NULL, 'administrator', NULL, '', 'link_edit.vesh', 'sysadmin', 'Link Manager', NULL, NULL, _binary '', NULL, 'manager', NULL, '<manager location="basiccontent" key="guid" flag_copy="flag_copy">\r\n	<view mode="table" orderby="realm, category" template="block.view.admin.generic" where="type=\'link\'">\r\n		<column type="guid" title="GUID" name="guid"/>\r\n		<column type="text" title="Realm" name="realm"/>\r\n		<column type="text" title="Category" name="category" />\r\n		<column type="text" title="Title" name="title"/>\r\n		<column type="text" title="Url" name="part" />\r\n	</view>\r\n	<form name="edit_this" template="block.form.generic" prefix_template_element="block.form.element">\r\n		<tab name="Info">\r\n			<element type="hidden" name="do" value="edited" readonly="yes"/>\r\n			<element type="hidden" name="guid"/>\r\n			<element type="random" name="filename"/>\r\n                    		<element type="hidden" name="type" value="link"/>\r\n\r\n			<element type="text" title="Realm" name="realm" value=""  description=""/>\r\n			<element type="text" title="Category" name="category" value=""  description=""/>\r\n			<element type="text" title="Workgroup" name="workgroup" value=""  description=""/>\r\n			<element type="text" title="Title" name="title" value=""  description=""/>\r\n			<element type="textarea" title="Description" name="description" value=""  description=""/>\r\n			<element type="text" title="URL" name="part" value=""  description=""/>\r\n		</tab>\r\n	</form>\r\n	<form name="delete_this" config="config.manager.form.generic.delete"/>\r\n</manager>', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('df54b843175d47c0a959d0b7f30fa9d8', '', NULL, 'administrator', NULL, '', 'df54b843175d47c0a959d0b7f30fa9d8', NULL, 'JS Theme', NULL, NULL, _binary '', NULL, 'theme', NULL, '/**\r\n Page title: [page.title]\r\n */\r\n\r\n[premerge.raw;htmlconv=no;noerr;protect=no]\r\n[page.part;htmlconv=no;noerr;protect=no]\r\n[postmerge.raw;htmlconv=no;noerr;protect=no]', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 2009),
	('0659D099B50C7EBA53052245DA8EC9BF', '', '396E617BAFB7D7634BD9D90AD650E83B', 'general', NULL, '', 'error.vesh', 'any', 'Error Occured', NULL, NULL, _binary '', NULL, 'page', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '$pageEx = array();\r\n\r\n$url = CEnvironment::GetSubmittedVariable(\'url\');\r\n$error = CEnvironment::GetSubmittedVariable(\'error\');\r\n\r\n$pageEx[\'raw\'] = CString::Format(\'The requested resource at %s experienced an error. %s\', $url, $error);\r\n\r\nreturn $pageEx;', NULL, 0, 0),
	('336394328f6a431eaa832330c12f2fe7', '', NULL, 'general', NULL, '', '336394328f6a431eaa832330c12f2fe7', NULL, 'Generic Theme', NULL, NULL, _binary '', NULL, 'theme', NULL, '<!doctype html>\r\n<html lang="en" >\r\n<head>\r\n<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">\r\n<title>[page.title;noerr]</title>\r\n\r\n<meta http-equiv="X-UA-Compatible" content="IE=9" >\r\n\r\n<link rel="shortcut icon" href="/static/favicon.ico">\r\n<link type="text/css" href="/static/config.inc.css" rel="stylesheet" />\r\n\r\n</head>\r\n\r\n<body>\r\n\r\n<!-- using generic theme. Custom theme was not found -->\r\n\r\n\r\n	 <div class="ui-widget">\r\n            <div class="ui-state-highlight ui-corner-all" style="padding: 0 .7em;">\r\n                <p>\r\n                    <span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>\r\n                    <strong>[page.title;noerr]:</strong> [premerge.message]</p>\r\n            </div>\r\n        </div>\r\n\r\n<div class="ui-widget">\r\n            <div class="ui-state-active ui-corner-all" style="padding: 0 .7em;">\r\n\r\n[premerge.raw;htmlconv=no;noerr]\r\n\r\n[page.part;htmlconv=no]\r\n\r\n[postmerge.raw;htmlconv=no;noerr]\r\n                \r\n                    \r\n            </div>\r\n       </div>\r\n\r\n\r\n\r\n\r\n\r\n<!-- current page: [self.SCRIPT_VIRTUAL_NAME] -->\r\n\r\n</body>\r\n\r\n</html>\r\n\r\n', NULL, NULL, NULL, NULL, NULL, NULL, NULL, '$pageEx = array();\r\n\r\n$pageEx[\'message\'] = CEnvironment::GetSubmittedVariable(\'message\', \'Unknown error\');\r\n\r\nreturn $pageEx;', NULL, 0, 2009),
	('8F495A5B013086B43FB026DD65EA58B3', '', NULL, 'administrator', NULL, '', '8F495A5B013086B43FB026DD65EA58B3', NULL, 'CSS Theme', NULL, NULL, _binary '', NULL, 'theme', NULL, '/* CSS */\r\n[premerge.raw;htmlconv=no;noerr]\r\n[page.part;htmlconv=no;noerr]\r\n[premerge.raw;htmlconv=no;noerr]', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 2009),
	('59B6AE21A61BD2A487EE1EE1A5634168', '', NULL, 'administrator', NULL, '', '59B6AE21A61BD2A487EE1EE1A5634168', NULL, 'Main Theme', NULL, NULL, _binary '', NULL, 'theme', NULL, '<!doctype html>\r\n<html lang="en" >\r\n<head>\r\n	<title>[page.title;noerr] -  [config.site.name] - Powered by [config.studio.name]</title>\r\n\r\n	<meta http-equiv="X-UA-Compatible" content="IE=9" >\r\n	<meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">\r\n	<meta http-equiv="Pragma" content="no-cache">\r\n\r\n	<link rel="shortcut icon" href="/static/favicon.ico">\r\n	<link type="text/css" href="/static/config.inc.css" rel="stylesheet" />\r\n	\r\n	<script type="text/javascript" src="/static/jquery-1.3.2.js"></script>\r\n\r\n	<script type="text/javascript" src="/static/jqueryUI/1.7.2/ui.jquery.js"></script>\r\n	<script type="text/javascript" src="/static/jqueryUI/extended.js"></script>\r\n\r\n	<script type="text/javascript" src="/static/jqueryTree/1.01/ui.tree.js"></script>\r\n\r\n	<script type="text/javascript">\r\n	<!--\r\n	$(function() {\r\n		jQueryEx.initializeDialogContainer();\r\n	});\r\n\r\n	$(document).ready(function() {\r\n	\r\n		$("#studioAccordion").accordion({\r\n					//event: "mouseover",\r\n					header: "h3"\r\n					});	\r\n				\r\n		$("#studioNotificationInfo").click(\r\n			function() {\r\n				$(this).hide(\'blind\');\r\n			}\r\n		);\r\n\r\n		$("#studioNotificationError").click(\r\n			function() 	{\r\n				$(this).hide(\'blind\');\r\n			}\r\n		);\r\n\r\n		$("#studioNotificationStatus").click(\r\n			function() 	{\r\n				$(this).hide(\'blind\');\r\n			}\r\n		);\r\n\r\n		$(\'#loading\').remove();\r\n		$(\'#studioPage\').removeClass(\'pseudohidden\');\r\n\r\n		//ajax calls\r\n		$.post(\'/content/administrator/webpart_currentbalance.vesh\',\r\n			function(data){\r\n				$(\'#studioWebPartCurrentBalance\').html(data);\r\n				}\r\n		);\r\n		$.post(\'/content/administrator/webpart_storageusage.vesh\', \r\n			function(data){\r\n				$(\'#studioWebPartCurrentStorageUsage\').html(data);\r\n				}\r\n		);\r\n\r\n		$.post(\'/auditor.vesh\', {\'do\': \'[request.do; noerr]\', \'guid\' : \'[request.guid; noerr]\', \'title\': \'[page.title; noerr]\', \'location\': \'[self.SCRIPT_VIRTUAL_NAME; noerr]\'},\r\n			function(data){\r\n				//alert(data);\r\n				}\r\n		);\r\n\r\n\r\n\r\n	});\r\n	//-->\r\n	</script>\r\n	\r\n</head>\r\n<body>\r\n<span id="loading"><img src="/static/images/spinner.gif"> Loading...</span>\r\n<div id="studioPage" class="pseudohidden">\r\n    <div id="studioTopPrintable" class="printonly">\r\n	<div id="studioTitle">\r\n		[page.title;noerr] - [config.site.name;noerr]\r\n	</div>\r\n	<div>Printed by [user.name_first] [user.name_last] on [var..now;frm=\'yyyy-mm-dd hh:nn:ss\']  (Server time)</div>\r\n    </div>\r\n    <div id="studioTop" class="webonly">\r\n	<div class="ui-widget">     \r\n    	<div class="ui-state-default" style="padding: 0 .7em; height:77px">\r\n          	<div style="float: right; text-align: right; width:600px" >\r\n                <div style="height:50px">\r\n                	Welcome [user.name_first] [user.name_last] |\r\n                	<!-- <a href="[user.profile;noerr;magnet=a]">My Account</a> | -->\r\n                	<a href="/log.vesh?do=logout">Log off / Change User</a>\r\n                	<!-- br><font size="-1">Logged in from 169.25.2.3@comcast.net</font-->\r\n                </div>\r\n             \r\n            \r\n	        </div>\r\n	        <div>\r\n		        <div style="height:50px" id="studioTitle">\r\n	            	<a href="/content/administrator/index.vesh">[config.site.name;noerr]</a>\r\n	            </div>\r\n	            \r\n                  Powered by <a href=" [config.studio.url.about;noerr]" target="about">[config.studio.name;noerr]</a>\r\n                  \r\n                                \r\n            </div>            \r\n       </div>\r\n    </div>\r\n    </div>\r\n\r\n     <div id="studioNotificationInfo" class="ui-widget webonly">\r\n            <div class="ui-state-highlight ui-corner-all" style="padding: 0 .7em;">\r\n                <p>\r\n                    <span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>\r\n                    <strong>Important Studio Message:</strong> <span id="studioNotificationInfoValue">[config.studio.motd;htmlconv=no;noerr;magnet=div]</span></p>\r\n            </div>\r\n        </div>\r\n        \r\n        <div id="studioNotificationError" class="ui-widget webonly">\r\n            <div class="ui-state-error ui-corner-all" style="padding: 0 .7em;">\r\n                <p>\r\n                    <span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span>\r\n                    <strong>Alert:</strong> <span id="studioNotificationErrorValue">[config.studio.alert;htmlconv=no;noerr;magnet=div]</span></p>\r\n            </div>\r\n        </div>\r\n        <!--div class="ui-widget" onClick="$(this).hide(\'blind\');">\r\n            <div class="ui-priority-secondary ui-corner-all" style="padding: 0 .7em;">\r\n                        <strong>Tip:</strong> Use the BulkUploader to upload more files faster!  <a href="#">Learn More</a> | <a href="#">More Tips</a>\r\n            </div>\r\n        </div-->\r\n\r\n    <div id="studioLeftNav" class="webonly">\r\n	<div class="ui-widget">\r\n            <div class="ui-state-highlight ui-corner-all" style="padding: 0 .7em;">\r\n                \r\n                    <span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>\r\n                    <strong>Current Balance</strong>\r\n				<div class="tip">\r\n\r\n                              <div class="studioWebpart" id="studioWebPartCurrentBalance"><img src="/static/images/spinner.gif"> Loading...</div>\r\n                    </div>\r\n                   \r\n            </div>\r\n            \r\n        </div>\r\n        \r\n       \r\n	<div id="studioAccordion">\r\n		\r\n		[premerge.links;htmlconv=no;noerr]				\r\n	</div>\r\n\r\n     \r\n    	\r\n        <div class="ui-widget">\r\n            <div class="ui-state-highlight ui-corner-all" style="padding: 0 .7em;">\r\n                \r\n                    <span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>\r\n                    <strong>Site Resources</strong>\r\n				<div class="tip">\r\n					<div id="studioWebPartCurrentStorageUsage"><img src="/static/images/spinner.gif"> Loading...</div>\r\n						\r\n					<div>Website Address:\r\n					<br><a href="http://[self.SERVER_NAME]" target="preview">[self.SERVER_NAME;ope=max:25]</A></div>\r\n					<br>\r\n                </div>\r\n                \r\n                    \r\n            </div>\r\n       </div>\r\n\r\n       <div class="ui-widget">\r\n            <div class="ui-state-highlight ui-corner-all" style="padding: 0 .7em;">\r\n                \r\n                    <div><span class="ui-icon ui-icon-note" style="float: left; margin-right: .3em;"></span>\r\n                    <strong>Account Basics</strong></div>\r\n				<div class="tip">\r\n					<div>Account ID: [config.site.client.id]</div>\r\n					<div>Site ID: [config.site.id]</div>\r\n					<br>\r\n				</div>\r\n				\r\n\r\n                    \r\n                    \r\n            </div>\r\n       </div>\r\n       <p>\r\n\r\n            <div class="ui-priority-secondary ui-corner-all"  style="padding: 0 .7em;">\r\n                \r\n                    <!--div><span class="ui-icon ui-icon-help" style="float: left; margin-right: .3em;"></span-->\r\n                    <strong>Online Support</strong></div>\r\n              <ul>                    \r\n	<li><a href="http://www.github.com/veshter" target="_blank">Source/Documentation</A></li>\r\n              </ul>                    \r\n            </div>\r\n\r\n\r\n <div id="studioContent">\r\n \r\n\r\n 	<div class="ui-widget" id="studioContextNav">\r\n 		[premerge.contextnav;htmlconv=no;noerr;]	\r\n       \r\n	</div>\r\n<div class="wrapper" >\r\n<div class="ui-widget webonly">\r\n            <div class="ui-state-highlight ui-corner-all" style="padding: 0">\r\n                <p>\r\n                    <span class="ui-icon ui-icon-wrench" style="float: left; margin-right: .3em;"></span>\r\n	[page.title;htmlconv=no;noerr;magnet=div+div] |\r\n	<a href="javascript:jQueryEx.showIFrameDialog(\'contexthelp\', \'About this page\', 400, 250, \'[config.studio.url.help]?realm=[page.realm]&folder=[page.folder]&filename=[page.filename]\', true, { \'Close\': function() { $(this).dialog(\'close\');}})">About this page</A>\r\n	<!--| <A HREF="[config.studio.url.help]?realm=[page.realm]&folder=[page.folder]&filename=[page.filename]" target="help">Video tutorials</A>\r\n	| <A HREF="[config.studio.url.help]?realm=[page.realm]&folder=[page.folder]&filename=[page.filename]" target="help">Give us your feedback</A>-->\r\n	<p>\r\n\r\n\r\n            <div class="ui-state-secondary ui-corner-all" style="padding: 0 .7em;">\r\n	[premerge.dialogs;htmlconv=no;noerr]\r\n            </div>\r\n\r\n\r\n            </div>\r\n       </div>\r\n\r\n       <div id="studioNotificationStatus" class="ui-widget webonly" [page.status;noerr;if [val] == \'\'; then \'style="display:none"\'; else \'\']>\r\n            <div class="ui-state-highlight ui-corner-all" style="padding: 0 .7em;">\r\n                <p>\r\n                    <span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>\r\n                    <strong>Action Status: </strong> \r\n                   <br><span id="studioNotificationStatusValue">[page.status;htmlconv=no;noerr]</span>\r\n            </div>\r\n       </div>\r\n        \r\n[premerge.raw;htmlconv=no;noerr;protect=no]\r\n\r\n[page.part;htmlconv=no;noerr;protect=no]\r\n\r\n[postmerge.raw;htmlconv=no;noerr;protect=no]\r\n       \r\n</div> \r\n\r\n        \r\n    </div>\r\n    \r\n    \r\n    <div id="studioFooter"  class="webonly">\r\n        <div class="ui-widget tip">\r\nCopyright (c) 2007-2013 Dobroslav Kolev <a href="http://www.opensource.org/licenses/MIT">MIT License</a>\r\n         </div>\r\n    </div>\r\n</div>\r\n\r\n\r\n</body>\r\n</html>\r\n<!--This page was generated on [self.SERVER_NAME] at [var..now;frm=\'yyyy-mm-dd hh:nn:ss\'] (Server time)-->\r\n\r\n', NULL, NULL, NULL, NULL, NULL, NULL, NULL, '\r\n$pageEx= array();\r\n\r\n\r\nfunction GetLinks()\r\n{\r\n	$realm = \'administrator\';// CEnvironment::GetSubmittedVariable(\'realm\', \'administrator\');//CEnvironment::GetMainApplication()->GetType()\r\n\r\n	$sentry = CEnvironment::GetMainApplication()->GetSentry();\r\n	//CEnvironment::Dump($sentry);\r\n\r\n	$user = CEnvironment::GetMainApplication()->GetUser();\r\n	//CEnvironment::Dump($user);\r\n\r\n\r\n	$do = CEnvironment::GetSubmittedVariable(\'do\');\r\n\r\n	switch ($do)\r\n	{\r\n		//case \'getlinks\':\r\n		default:\r\n			$data = array();\r\n\r\n			$c = 0;\r\n			$tools = array();\r\n			//go through all available datagrids and see if you can get the information\r\n			while (($datagrid = CEnvironment::GetMainApplication()->GetDataGrid($c)) != null)\r\n			{\r\n				if ($datagrid->Select(\'basiccontent\', \'*\', CString::Format(\'realm=%s AND type=%s\', CString::Quote($realm), CString::Quote(\'link\')), \'-1\', \'category\'))\r\n				{\r\n					\r\n					$data = $datagrid->Get(0,false);\r\n\r\n					foreach ($data as $row)\r\n					{\r\n\r\n						$category = $row[\'category\'];\r\n\r\n						if (empty($category))\r\n						{\r\n							$category = \'Miscellaneous\';\r\n						}\r\n\r\n						//only set new configuration properties is the key was not found\r\n						if (count($tools[$category]) == 0 || !array_key_exists ($row[\'title\'], $tools[$category]))\r\n						{\r\n							//only let the user see the link, if they have access\r\n							if ($user->IsSuperuser() || $sentry->ValidateAccess($user->GetGuid(), $row[\'workgroup\']))\r\n							{\r\n								$tools[$category][$row[\'title\']] = $row;\r\n							}\r\n						}\r\n					}\r\n\r\n				}\r\n				$c++;\r\n					\r\n				//CEnvironment::Dump($status = $datagrid->GetDatabaseLink()->GetStatus());\r\n\r\n			}\r\n\r\n\r\n			//sort the tools by category\r\n			ksort($tools);\r\n\r\n			//CEnvironment::Dump($tools);\r\n\r\n			$link_toprint = \'\';\r\n			if(is_array($tools))\r\n			{\r\n				foreach($tools as $tool_key => $tool_value)\r\n				{\r\n					$link_toprint .= \'<div>\';\r\n					$link_toprint .= \'<h3><a href="#">\' . $tool_key . \'</a></h3>\';\r\n\r\n					ksort($tool_value);\r\n\r\n					if(is_array($tool_value))\r\n					{\r\n						$link_toprint .= \'<div>\';\r\n						foreach($tool_value as $tool_link)\r\n						{\r\n							$link_toprint .= \'<A HREF="\' . $tool_link[\'part\'] . \'" >\' . $tool_link[\'title\'] . \'</A><br>\';\r\n						}\r\n						$link_toprint .= \'</div>\';\r\n					}\r\n\r\n					$link_toprint .= \'</div>\';\r\n\r\n				}\r\n			}\r\n\r\n\r\n			return $link_toprint;\r\n\r\n			//$response = array();\r\n\r\n			//$response[\'content\'] = $link_toprint;\r\n\r\n			//CEnvironment::Dump($response);\r\n\r\n			//print CCollection::ToXMLWorker($response, \'doc\', 0, true);\r\n\r\n\r\n			//default:\r\n			//	throw new CExceptionInvalidData(\'Request was not recognized\');\r\n	}\r\n\r\n}\r\n\r\nfunction GetDialogs($context)\r\n{\r\n	$realm = \'administrator\';// CEnvironment::GetSubmittedVariable(\'realm\', \'administrator\');//CEnvironment::GetMainApplication()->GetType()\r\n\r\n	$sentry = CEnvironment::GetMainApplication()->GetSentry();\r\n	//CEnvironment::Dump($sentry);\r\n\r\n	$user = CEnvironment::GetMainApplication()->GetUser();\r\n	//CEnvironment::Dump($user);\r\n	\r\n	$do = CEnvironment::GetSubmittedVariable(\'do\');\r\n\r\n	switch ($do)\r\n	{\r\n		//case \'getlinks\':\r\n		default:\r\n			$data = array();\r\n\r\n			$c = 0;\r\n			$tools = array();\r\n			//go through all available datagrids and see if you can get the information\r\n			while (($datagrid = CEnvironment::GetMainApplication()->GetDataGrid($c)) != null)\r\n			{\r\n				if ($datagrid->Select(\'basiccontent\', \'*\', CString::Format(\'parent=%s AND realm=%s AND type=%s\', CString::Quote($context[\'guid\']), CString::Quote($realm), CString::Quote(\'dialog\')), \'-1\', \'category\'))\r\n				{\r\n					\r\n					$data = $datagrid->Get(0,false);\r\n\r\n					foreach ($data as $row)\r\n					{\r\n\r\n						$category = $row[\'category\'];\r\n\r\n						if (empty($category))\r\n						{\r\n							$category = \'Miscellaneous\';\r\n						}\r\n\r\n						//only set new configuration properties is the key was not found\r\n						if (count($tools[$category]) == 0 || !array_key_exists ($row[\'title\'], $tools[$category]))\r\n						{\r\n							//only let the user see the link, if they have access\r\n							if ($user->IsSuperuser() || $sentry->ValidateAccess($user->GetGuid(), $row[\'workgroup\']))\r\n							{\r\n								$tools[$category][$row[\'title\']] = $row;\r\n							}\r\n						}\r\n					}\r\n\r\n				}\r\n				$c++;\r\n					\r\n				//CEnvironment::Dump($status = $datagrid->GetDatabaseLink()->GetStatus());\r\n\r\n			}\r\n\r\n\r\n			//sort the tools by category\r\n			ksort($tools);\r\n\r\n			//CEnvironment::Dump($tools);\r\n\r\n			$link_toprint = \'\';\r\n			if(is_array($tools))\r\n			{\r\n				foreach($tools as $tool_key => $tool_value)\r\n				{\r\n					$link_toprint .= \'<fieldset class="ui-state-highlight ui-corner-all">\';\r\n					$link_toprint .= \'<legend>\' . $tool_key . \'</legend>\';\r\n\r\n					ksort($tool_value);\r\n\r\n					if(is_array($tool_value))\r\n					{\r\n\r\n						$theme = array();\r\n						$theme[\'part\'] = \'<div style="float: left; width:60px; height:85px; text-align:center">[page.part;htmlconv=no]</div>\';\r\n\r\n						foreach($tool_value as $tool_link)\r\n						{\r\n\r\n							$widget = new CWidgetDialog();\r\n							$widget->SetTheme($theme);\r\n							$widget->LoadData($tool_link);\r\n\r\n\r\n							$link_toprint .= $widget->ToString(); 	\r\n							\r\n						}\r\n						\r\n					}\r\n\r\n					$link_toprint .= \'<div style="clear: both;"></div>\';\r\n					$link_toprint .= \'</fieldset>\';\r\n\r\n				}\r\n			}\r\n\r\n\r\n			return $link_toprint;\r\n\r\n			//$response = array();\r\n\r\n			//$response[\'content\'] = $link_toprint;\r\n\r\n			//CEnvironment::Dump($response);\r\n\r\n			//print CCollection::ToXMLWorker($response, \'doc\', 0, true);\r\n\r\n\r\n			//default:\r\n			//	throw new CExceptionInvalidData(\'Request was not recognized\');\r\n	}\r\n\r\n}\r\n\r\n$pageEx[\'links\'] = GetLinks();\r\n$pageEx[\'dialogs\'] = GetDialogs($context);\r\n\r\nreturn $pageEx;	\r\n', NULL, 0, 2009),
	('8F495A5B013086B43FB026DD65EA58B1', NULL, NULL, 'general', NULL, '', '8F495A5B013086B43FB026DD65EA58B1', '', 'Plain Text Theme', NULL, NULL, _binary '', NULL, 'theme', NULL, '[premerge.raw;htmlconv=no;noerr;protect=no][page.part;htmlconv=no;noerr;protect=no][postmerge.raw;htmlconv=no;noerr;protect=no]', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('59B6AE21A61BD2A487EE1EE1A5634163', NULL, '8F495A5B013086B43FB026DD65EA58B1', 'general', NULL, '', 'robots.txt', 'any', 'Robots', 'page', NULL, _binary '', NULL, 'page', NULL, 'User-agent: *\r\nDisallow: /admin/\r\nDisallow: /administrator/\r\nAllow: /', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('021D27DE34ABCED74DA8A4021CD05B9B', '', NULL, 'administrator', NULL, '', '021D27DE34ABCED74DA8A4021CD05B9B', NULL, 'XML Theme', NULL, NULL, _binary '', NULL, 'theme', NULL, '[premerge.raw;htmlconv=no;noerr]\r\n[page.part;htmlconv=no;noerr]\r\n[postmerge.raw;htmlconv=no;noerr]', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 2009),
	('55A5940ACBB3D1C08678DD6AFFA404AC', '', '396E617BAFB7D7634BD9D90AD650E83B', 'general', NULL, '', 'notfound.vesh', 'any', 'Resource Not found', NULL, NULL, _binary '', NULL, 'page', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '$pageEx = array();\r\n\r\n$url = CEnvironment::GetSubmittedVariable(\'url\');\r\n\r\n$pageEx[\'raw\'] = CString::Format(\'The requested resource at %s was not found on this web site. Please check the address and try again.\', $url);\r\n\r\nreturn $pageEx;', NULL, 0, 0),
	('F4B2C9EB5BE940EBB42EDE3D57AA9A41', '', NULL, 'administrator', 'SysAdmin', '', 'F4B2C9EB5BE940EBB42EDE3D57AA9A43', 'sysadmin', 'Dialogs/Popups', NULL, NULL, _binary '', NULL, 'link', '', '/content/administrator/dialog_edit.vesh', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('59B6AE21A61BD2A487EE1EE1A5634162', '', NULL, 'administrator', NULL, '', 'template_edit.vesh', 'sysadmin', 'Template Manager', NULL, NULL, _binary '', NULL, 'manager', NULL, '<manager location="template" key="guid" flag_copy="flag_copy">\r\n	<view mode="table" orderby="name" template="block.view.admin.generic">\r\n		<column type="guid" title="GUID" name="guid"/>\r\n		<column type="text" title="Name" name="name"/>\r\n		<column type="text" title="Notes" name="notes" />\r\n	</view>\r\n	<form name="edit_this" template="block.form.generic" prefix_template_element="block.form.element">\r\n		<tab name="Info">\r\n			<element type="hidden" name="do" value="edited" readonly="yes"/>\r\n			<element type="hidden" name="guid"/>\r\n			<element type="text" title="Name" name="name" value=""  description=""/>\r\n			<element type="text" title="Notes" name="notes" value=""  description=""/>\r\n			<element type="textarea" title="Body Plain" name="body_plain" value=""  description=""/>\r\n			<element type="textarea" title="Body XML" name="body_xml" value=""  description=""/>\r\n			<element type="textarea" title="Body HTML" name="body_html" value=""  description=""/>\r\n		</tab>\r\n	</form>\r\n	<form name="delete_this" config="config.manager.form.generic.delete"/>\r\n</manager>', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('F4B2C9EB5BE940EBB42EDE3D57AA9A42', '', NULL, 'administrator', 'SysAdmin', '', 'a727baceed7b438b9067671420c79ab2', 'sysadmin', 'Templates', NULL, NULL, _binary '', NULL, 'link', '', '/content/administrator/template_edit.vesh', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('', '', NULL, 'general', NULL, '', '', NULL, NULL, NULL, NULL, NULL, NULL, '', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('A59E3DF9D2154D47F546A663D65AA104', '', '59B6AE21A61BD2A487EE1EE1A5634062', 'administrator', NULL, '', 'webpart_sessionsgraph.vesh', 'admin', 'Sessions Graph', NULL, NULL, NULL, NULL, 'page', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '$pageEx = array();\r\n\r\n$session = CEnvironment::GetMainApplication()->GetSession();\r\n\r\n$cache = $session->GetRegisteredVariable(\'sessionsgraph\', null, false);\r\n\r\nif (CString::IsNullOrEmpty($cache))\r\n{\r\n	$cache = \'No traffic information found.\';\r\n\r\n	function GetStatsFromUrl($url)\r\n	{\r\n\r\n\r\n		$curl_handle=curl_init();\r\n		curl_setopt($curl_handle,CURLOPT_URL,$url);\r\n		curl_setopt($curl_handle,CURLOPT_CONNECTTIMEOUT,2);\r\n		curl_setopt($curl_handle,CURLOPT_RETURNTRANSFER,1);\r\n		$buffer = curl_exec($curl_handle);\r\n		curl_close($curl_handle);\r\n\r\n		return $buffer;\r\n	}\r\n\r\n\r\n\r\n	$config = CEnvironment::GetMainApplication()->GetProperties();\r\n\r\n	$url = $config[\'studio\'][\'url\'][\'webstats\']\r\n	. \'&gtype=5&spview=1&splist=|1102|&x=1\';\r\n\r\n	$buffer = GetStatsFromUrl($url);\r\n\r\n	if (!CString::IsNullOrEmpty($buffer))\r\n	{\r\n\r\n		$matches = array();\r\n\r\n		//move comments\r\n		$buffer = preg_replace(\'/#.+#/ms\', \'\', $buffer);\r\n\r\n		preg_match_all(\'/([A-Za-z]{3}\\s+[0-9]+\\/[0-9]+)\\t+([0-9]+)/m\', $buffer, $matches);\r\n\r\n		$summary = array();\r\n		for($loop = 0; $loop < count($matches[1]); $loop++)\r\n		{\r\n			$summary[] = array(\'name\' => trim($matches[1][$loop]), \'quantity\' => ($matches[2][$loop]));\r\n		}\r\n\r\n		$html = <<< HTML\r\n<table style="width:100%">\r\n	<tr class="ui-state-secondary ui-corner-all" >\r\n		<td align="center" >\r\n<div class="ui-state-default ui-corner-all">		\r\n[summary.name;block=td]\r\n</div>\r\n\r\n<strong>[summary.quantity]</strong>\r\n		</td>\r\n	</tr>\r\n	<tr >\r\n		<td colspan=2>\r\n		[summary;block=tr;nodata]There is no session information for for this web site.\r\n		</td>\r\n	</tr>\r\n</table>\r\n\r\nHTML;\r\n\r\n		$doc = new CDocument($html, \'html\', false);\r\n		$doc->MergeBlock(\'summary\', $summary);\r\n\r\n		$cache = $doc->ToString();\r\n\r\n	}\r\n\r\n	$session->RegisterVariable(\'sessionsgraph\', $cache, false);\r\n\r\n}\r\nelse\r\n{\r\n	$cache .= \'<!-- from cache -->\';\r\n}\r\n\r\n$pageEx[\'raw\'] = $cache;\r\n\r\nreturn $pageEx;', NULL, 0, 0),
	('28DE75AC9635A2274E9C227B0961D170', '0cbf48e7868a43c1add915d7a160aad5', NULL, 'administrator', NULL, '', '28DE75AC9635A2274E9C227B0961D170', 'profile', 'Workgroups', NULL, NULL, NULL, NULL, 'dialog', NULL, '<dialog name="workgroups" width="700" height="550" modal="yes" template="block.dialog.admin.generic.invokable.iframe" url_icon="/static/images/icons/48x48/shapes_48.png">\r\n	<content><![CDATA[/content/administrator/workgroup_edit.vesh]]>	</content>\r\n<callback name="Done"><![CDATA[\r\n\r\n//refresh the file listing\r\nlocation.reload(true)\r\n\r\n]]></callback>\r\n</dialog>\r\n', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('F50C5A1CE47029546BB7E001DA194E8B', '', '59B6AE21A61BD2A487EE1EE1A5634062', 'administrator', NULL, '', 'webpart_trafficsummary.vesh', 'admin', 'Traffic Summary', NULL, NULL, _binary '', NULL, 'page', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '<?\r\n\r\n$pageEx = array();\r\n\r\n$session = CEnvironment::GetMainApplication()->GetSession();\r\n\r\n$cache = $session->GetRegisteredVariable(\'trafficsummary\', null, false);\r\n\r\nif (true) //CString::IsNullOrEmpty($cache))\r\n{\r\n	$cache = \'No traffic information found.\';\r\n\r\n	$config = CEnvironment::GetMainApplication()->GetProperties();\r\n\r\n	if (isset($config[\'site\'][\'analytics\'][\'provider\'][\'name\']))\r\n	{\r\n		switch($config[\'site\'][\'analytics\'][\'provider\'][\'name\'])\r\n		{\r\n			case  \'googleanalytics\':\r\n				$provider = new CAnalyticsProviderGoogle($config[\'site\'][\'analytics\'][\'login\'],$config[\'site\'][\'analytics\'][\'password\']);\r\n\r\n				$provider->GenerateReport($config[\'site\'][\'analytics\'][\'profile\'],array(\'source\', \'keyword\'),\r\n				array(\'entrances\', \'newVisits\', \'visits\', \'uniquePageviews\', \'pageviews\', \'bounces\', \'timeOnPage\', \'timeOnSite\', \'exits\'),\r\n				\'keyword\', $filter, date(\'Y-m-d\', strtotime(\'-1 week\')), date(\'Y-m-d\'));\r\n\r\n				$data = $provider->Get(true);\r\n					\r\n				$summary = array();\r\n				$summary[] = array(\'name\' => \'Unique visits\', \'quantity\' => $data[\'newVisits\']);\r\n				$summary[] = array(\'name\' => \'All visits\', \'quantity\' => $data[\'visits\']);\r\n				\r\n				$summary[] = array(\'name\' => \'Unique page views\', \'quantity\' => $data[\'uniquePageviews\']);\r\n				$summary[] = array(\'name\' => \'All page views\', \'quantity\' => $data[\'pageviews\']);\r\n								\r\n				$summary[] = array(\'name\' => \'Bounces\', \'quantity\' => $data[\'bounces\']);\r\n				$summary[] = array(\'name\' => \'Bounce Rate\', \'quantity\' => round($data[\'bounces\']/$data[\'entrances\']*100) . \'%\');\r\n				$summary[] = array(\'name\' => \'Exits\', \'quantity\' => $data[\'exits\']);\r\n\r\n				\r\n				$timeOnPage = $data[\'timeOnPage\']/($data[\'pageviews\']- $data[\'exits\']);\r\n				$summary[] = array(\'name\' => \'Average time on page\', \'quantity\' => CString::Format(\'%d min(s) and %d sec(s)\', $timeOnPage/60, $timeOnPage%60));\r\n				\r\n				$timeOnSite = $data[\'timeOnSite\']/$data[\'visits\'];\r\n				$summary[] = array(\'name\' => \'Average time on site\', \'quantity\' => CString::Format(\'%d min(s) and %d sec(s)\', $timeOnSite/60, $timeOnSite%60));\r\n					\r\n				$xml = <<<XML\r\n<view template="block.view.admin.report.simple">\r\n	<column type="text" title="Name" name="name" />\r\n	<column type="text" title="Quantity" name="quantity" />\r\n</view>\r\nXML;\r\n\r\n				$view = new CView();\r\n				if ($view->Configure($xml))\r\n				{\r\n					$view->SetData($summary);\r\n\r\n					$cache = $view->ToString();\r\n				}\r\n				break;\r\n		}\r\n\r\n		$session->RegisterVariable(\'trafficsummary\', $cache, false);\r\n\r\n	}\r\n	else\r\n	{\r\n		$cache = \'Traffic monitoring has not been confgured\';\r\n	}\r\n}\r\nelse\r\n{\r\n	$cache .= \'<!-- from cache -->\';\r\n}\r\n\r\n$pageEx[\'raw\'] = $cache;\r\n\r\nreturn $pageEx;\r\n?>', NULL, 0, 0),
	('1712EA72851688503DC7062285705C11', '', '59B6AE21A61BD2A487EE1EE1A5634063', 'administrator', NULL, '', 'event_recurrence.vesh', 'any', 'Event Recurrence', NULL, NULL, NULL, NULL, 'page', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '\r\n$pageEx = array();\r\n\r\n$schedule = CEnvironment::GetSubmittedVariable(\'schedule\', \'* * * * *\');\r\n\r\n$parser = new CParserCron();\r\n$isValidSchedule = $parser->Parse($schedule, CDateTime::Now()->GetMonth(), CDateTime::Now()->GetYear());\r\n\r\n//figure out what mode we are in\r\n$mode = \'\';\r\nif ($isValidSchedule)\r\n{\r\n\r\n	//# 0 | .--------- minute (0-60)\r\n	//# 1 | | .------- hour (0-24)\r\n	//# 2 | | | .----- day of the month (1-31)\r\n	//# 3 | | | | .--- month (1-12 or jan-dec)\r\n	//# 4 | | | | | .- day of the week (0-6 or sun-sat)\r\n	//# 5 | | | | | | .- command to execute\r\n	//# | | | | | | |\r\n	//# * * * * * * *\r\n\r\n	$nodes = $parser->GetNodes();\r\n	if (($nodes[2] != \'*\') && ($nodes[3] != \'*\'))\r\n	{\r\n		$mode = \'yearly\';\r\n	}\r\n	else if ($nodes[2] != \'*\')\r\n	{\r\n		$mode = \'monthly\';\r\n	}\r\n	else if ($nodes[4] != \'*\')\r\n	{\r\n		$mode = \'weekly\';\r\n	}\r\n	else\r\n	{\r\n		$mode = \'daily\';\r\n	}\r\n}\r\n\r\n\r\n$modes = array(\'daily\', \'weekly\', \'monthly\', \'yearly\');\r\n\r\n$weekdays = array(\r\n0 => \'Sunday\',\r\n1 => \'Monday\',\r\n2 => \'Tuesday\',\r\n3 => \'Wednesday\',\r\n4 => \'Thusday\',\r\n5 => \'Friday\',\r\n6 => \'Saturday\',\r\n);\r\n\r\n$days = range(1, 31, 1);\r\n\r\n$months = array(\r\n1 => \'January\',\r\n2 => \'Febraury\',\r\n3 => \'March\',\r\n4 => \'April\',\r\n5 => \'May\',\r\n6 => \'June\',\r\n7 => \'July\',\r\n8 => \'August\',\r\n9 => \'September\',\r\n10 => \'October\',\r\n11 => \'November\',\r\n12 => \'December\'\r\n);\r\n\r\nforeach ($modes as $key)\r\n{\r\n	$selected = $mode == $key ? \'selected\' : \'\';\r\n\r\n	$value = $key;\r\n	$modes .= CString::Format(\'<option value="%s" %s>%s</option>\', $key, $selected, $value);\r\n}\r\n\r\nforeach ($weekdays as $key => $value)\r\n{\r\n	$selected = \'\';\r\n\r\n	if ($mode == \'weekly\')\r\n	{\r\n		$selected = in_array($key, $parser->GetWeekdays()) ? \'selected\' : \'\';\r\n	}\r\n\r\n	$weekly_day .= CString::Format(\'<option value="%s" %s>%s</option>\', $key, $selected, $value);\r\n}\r\n\r\nforeach ($days as $key)\r\n{\r\n	$selected = \'\';\r\n\r\n	if ($mode == \'monthly\')\r\n	{\r\n		$selected = in_array($key, $parser->GetDays()) ? \'selected\' : \'notfound\';\r\n	}\r\n\r\n	$value = $key;\r\n	$monthly_day .= CString::Format(\'<option value="%s" %s>%s</option>\', $key, $selected, $value);\r\n}\r\n\r\n\r\nforeach ($months as $key => $value)\r\n{\r\n	$selected = \'\';\r\n\r\n	if ($mode == \'yearly\')\r\n	{\r\n		$selected = in_array($key, $parser->GetMonths()) ? \'selected\' : \'\';\r\n	}\r\n\r\n	$yearly_month .= CString::Format(\'<option value="%s" %s>%s</option>\', $key, $selected, $value);\r\n}\r\n\r\nforeach ($days as $key)\r\n{\r\n	$selected = \'\';\r\n\r\n	if ($mode == \'yearly\')\r\n	{\r\n		$selected = in_array($key, $parser->GetDays()) ? \'selected\' : \'\';\r\n	}\r\n\r\n	$value = $key;\r\n	$yearly_day .= CString::Format(\'<option value="%s" %s>%s</option>\', $key, $selected, $value);\r\n}\r\n\r\n$self = CEnvironment::GetScriptVirtualName();\r\n\r\n$pageEx[\'raw\'] = <<< HTML\r\n\r\n<script type="text/javascript"\r\n	src="http://www.veshter.com/static/jquery/1.7.1/jquery-1.3.2.js"></script>\r\n\r\n<script type="text/javascript"\r\n	src="http://www.veshter.com/static/jquery/1.7.1/ui/ui.core.js"></script>\r\n\r\n<script type="text/javascript">\r\n    <!--        \r\n\r\n        $(document).ready(function() {\r\n\r\n            $("#weekly_day").change(function() {\r\n                var str = \'\';\r\n                $("#weekly_day option:selected").each(function() {\r\n                    if (str != \'\') {\r\n                        str += \',\';\r\n                    }\r\n                    str += $(this).attr(\'value\');\r\n                });\r\n\r\n                $(\'#schedule\').text(\'* * * * \' + str);\r\n            });\r\n\r\n            $("#monthly_day").change(function() {\r\n                var str = \'\';\r\n                $("#monthly_day option:selected").each(function() {\r\n                    if (str != \'\') {\r\n                        str += \',\';\r\n                    }\r\n                    str += $(this).attr(\'value\');\r\n                });\r\n\r\n                $(\'#schedule\').text(\'* * \' + str + \' * *\');\r\n            });\r\n            $("#yearly_day, #yearly_month").change(function() {\r\n	            var str = \'\';\r\n	            $("#yearly_day option:selected").each(function() {\r\n	                if (str != \'\') {\r\n	                    str += \',\';\r\n	                }\r\n	                str += $(this).attr(\'value\');\r\n	            });\r\n	            var str2 = \'\';\r\n	            $("#yearly_month option:selected").each(function() {\r\n	                if (str2 != \'\') {\r\n	                    str2 += \',\';\r\n	                }\r\n	                str2 += $(this).attr(\'value\');\r\n	            });\r\n	\r\n	            $(\'#schedule\').text(\'* * \' + str + \' \' + str2 + \' *\');\r\n	            });\r\n\r\n            $("#mode").change(function() {\r\n            	$(\'#daily\').hide();\r\n                $(\'#weekly\').hide();\r\n                $(\'#monthly\').hide();\r\n                $(\'#yearly\').hide();\r\n\r\n                var mode = $(\'#mode option:selected\').attr(\'value\');\r\n                $(\'#\' + mode).show();\r\n                $(\'#\' + mode).change();\r\n\r\n            }).change();\r\n\r\n        });\r\n\r\n    //-->\r\n    </script>\r\n\r\nChoose the recurrence mode and then specify the desired interval by selecting the appropriate options. To select multiple items, press the Control key and then select.\r\n\r\n<p><div id="recurrance"><span> Repeat on a <select id="mode">\r\n$modes\r\n\r\n</select> basis. </span> <span>Repeat every</span> \r\n\r\n<span id="daily" style="display:none">day</span> <span\r\n	id="weekly"> <select id="weekly_day" multiple size="7">\r\n	$weekly_day\r\n</select></span>\r\n\r\n<span id="monthly" style="display:none"> <select id="monthly_day" multiple size="12">\r\n$monthly_day\r\n</select> day of every month.</span>\r\n\r\n<span id="yearly" style="display:none"> <select id="yearly_month"\r\n	multiple size="12">\r\n	$yearly_month\r\n</select> on <select id="yearly_day" multiple size="12">\r\n	$yearly_day\r\n</select> day of the month.</span>\r\n\r\n\r\n<p><span id="schedule" style="display:none">$schedule</span>\r\n\r\n<!--p><a href="javascript: window.location.href = \'$self?schedule=\' + $(\'#schedule\').text()">Reload schedule as if editing</a-->\r\n\r\n</div>\r\n\r\nHTML;\r\n\r\nreturn $pageEx;', NULL, 0, 0),
	('8F495A5B013086B43FB026DD65EA5811', NULL, '8F495A5B013086B43FB026DD65EA58B2', 'administrator', NULL, '', 'auditor.vesh', 'admin', 'Auditor', NULL, NULL, NULL, NULL, 'page', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '$pageEx = array();\r\n\r\n$userinfo = CEnvironment::GetMainApplication()->GetUser();\r\n$userinfo = $userinfo->properties;\r\n\r\n$user = $userinfo[\'guid\'];\r\n$user_name = $userinfo[\'name_first\'] . \' \' . $userinfo[\'name_last\'];\r\n\r\n$location = CEnvironment::GetSubmittedVariable(\'location\');\r\n$title = CEnvironment::GetSubmittedVariable(\'title\');\r\n$do = CEnvironment::GetSubmittedVariable(\'do\');\r\n$guid = CEnvironment::GetSubmittedVariable(\'guid\');\r\n\r\n$message = CString::Format(\'User %s executed %s on record %s\', CString::Quote($user_name), CString::Quote($do), CString::Quote($guid));\r\nif (CEventLog::Log(\'Ajax Auditor\', CString::Escape($title), $message, \'audit\', 5, CString::Escape($user)))\r\n{\r\n}\r\nelse\r\n{\r\n$pageEx[\'raw\'] = \'Failed to create audit trail\';\r\n}\r\n\r\n\r\n\r\nreturn $pageEx;', NULL, 0, 0),
	('8E201BADE9F7A20E1F38F81D7BEE4823', NULL, NULL, 'sys', NULL, '', '8E201BADE9F7A20E1F38F81D7BEE4823', 'any', NULL, NULL, NULL, NULL, NULL, 'theme', NULL, 'Used for system files', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0),
	('387B7B3DC39F931B64F413A1B0F419A3', NULL, NULL, 'administrator', NULL, '', 'script_edit.vesh', 'admin', 'Site Scripts', NULL, NULL, NULL, NULL, 'page', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '$pageEx = array();\r\n\r\nfunction GetScripts($folder)\r\n{\r\n	$scripts = array();\r\n	$dh  = opendir($folder);\r\n	while (false !== ($filename = readdir($dh)))\r\n	{\r\n		if (!in_array($filename,  array(\'.\', \'..\', \'.cache\', \'.dev\', \'.settings\', \'CVS\')))\r\n		{\r\n			//$files[] = $filename;\r\n			$path = $folder . _DIRSLASH . $filename;\r\n			//CEnvironment::WriteLine(\'Looking at \' . $path);\r\n			if (is_dir($path))\r\n			{\r\n				//CEnvironment::WriteLine(\'Going into \' . $path);\r\n				$scripts = array_merge($scripts, GetScripts($path));\r\n			}\r\n			else if (preg_match(\'/class\\.[a-z]+\\.php/\', $filename))\r\n			{\r\n\r\n				$handle = fopen($path, \'r\');\r\n				$content = fread($handle, filesize($path));\r\n				fclose($handle);\r\n\r\n				preg_match(\'/\\$Revision: ?([0-9]+\\.[0-9]+) ?\\$/\', $content, $matches);\r\n\r\n				if (count($matches))\r\n				{\r\n					$version = floatval($matches[1]);\r\n\r\n					$classes = array();					\r\n\r\n					try\r\n					{\r\n						$scripts[] = array(\'folder\' => str_replace(_PATH_FRAMEWORK . _DIRSLASH, \'\', $folder), \'filename\' => $filename, \'version\' => $version);\r\n					}\r\n					catch (Exception $ex)\r\n					{\r\n					}\r\n				}\r\n			}\r\n		}\r\n	}\r\n\r\n	return $scripts;\r\n}\r\n\r\n\r\n$session = CEnvironment::GetMainApplication()->GetSession();\r\n\r\n$cache = $session->GetRegisteredVariable(\'scripts\', null, false);\r\n\r\nif (CString::IsNullOrEmpty($cache))\r\n{\r\n	$cache = \'No script data found.\';\r\n\r\n	$config = CEnvironment::GetMainApplication()->GetProperties();\r\n\r\n	$internalToken = CEnvironment::GetMainApplication()->GetSession()->GetRegisteredVariable(\'internalToken\', \'\', true);\r\n\r\n	if (!CString::IsNullOrEmpty($internalToken))\r\n	{\r\n		$scripts_local = GetScripts(_PATH_FRAMEWORK);\r\n		\r\n		$wsClient = new CSoapClient(\'https://secure.veshter.com/webservices/scripts.wsdl\');\r\n		$request = array(\'resource\' => $config[\'site\'][\'resource\'][\'id\'], \'token\' => $internalToken);\r\n		$response = $wsClient->GetLatestScripts($request);  //call this to get response from server\r\n		\r\n		$scripts_library = $response->scripts;\r\n\r\n		$data = array();\r\n		\r\n		while(count($scripts_library))	\r\n		{\r\n			$script = array_shift($scripts_library);\r\n			\r\n			for ($loop = 0; $loop < count($scripts_local); $loop++)\r\n			{\r\n				if (($script->folder == $scripts_local[$loop][\'folder\']) && ($script->filename == $scripts_local[$loop][\'filename\']))\r\n				{\r\n					$row = $scripts_local[$loop];\r\n					$row[\'status\'] = $row[\'version\'] < $script->version ? \'<strong><font color=red>Outdated</font></strong>\' : \'Current\';\r\n					$row[\'version_latest\'] = $script->version;\r\n					$data[] = $row;\r\n					\r\n					unset($scripts_local[$loop]);\r\n\r\n					break;\r\n				}	\r\n			}\r\n\r\n			sort($scripts_local);\r\n		}\r\n		\r\n		foreach ($scripts_local as $row)\r\n		{\r\n			$row[\'status\'] = \'<strong><font color=orange>Extranous</font></strong>\';\r\n			$row[\'version_latest\'] = -1;\r\n			$data[] = $row;\r\n		}\r\n\r\n	\r\n		$xml = <<< XML\r\n		<view xmlns="http://schemas.veshter.net/xsd/view.xsd"\r\n			template="block.view.admin.report" >\r\n				<column type="text" title="Folder" name="folder"/>\r\n				<column type="text" title="Filename" name="filename"/>\r\n			       	<column type="text" title="Status" name="status"/>\r\n			       	<column type="text" title="Current Version" name="version"/>\r\n			       	<column type="text" title="Latest Version" name="version_latest"/>\r\n		\r\n			</view>\r\n		\r\n		\r\nXML;\r\n		\r\n		\r\n		\r\n		$view = new CView();\r\n		\r\n		if ($view->Configure($xml))\r\n		{\r\n			$view->SetData($data);\r\n			$cache = $view->ToString();\r\n		}\r\n		else\r\n		{\r\n			$cache = \'View failed to configure\';\r\n		}\r\n	}\r\n\r\n	$session->RegisterVariable(\'scripts\', $cache, false);\r\n\r\n}\r\nelse\r\n{\r\n	$cache .= \'<!-- from cache -->\';\r\n}\r\n\r\n\r\n$pageEx[\'raw\'] = $cache;\r\nreturn $pageEx ;', NULL, 0, 0),
	('F4B2C9EB5BE940EBB42EDE3D57AA9A11', NULL, NULL, 'administrator', 'SysAdmin', '', 'F4B2C9EB5BE940EBB42EDE3D57AA9A11', 'sysadmin', 'Scripts', NULL, NULL, NULL, NULL, 'link', NULL, '/content/administrator/script_edit.vesh', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0);
/*!40000 ALTER TABLE `basiccontent` ENABLE KEYS */;
/*!40101 SET SQL_MODE=IFNULL(@OLD_SQL_MODE, '') */;
/*!40014 SET FOREIGN_KEY_CHECKS=IF(@OLD_FOREIGN_KEY_CHECKS IS NULL, 1, @OLD_FOREIGN_KEY_CHECKS) */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
